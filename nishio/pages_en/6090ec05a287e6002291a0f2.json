Hatena2010-08-15
code:hatena
 <body>
 *1281831565*Ruby tinkering
 Tinkering with Ruby Now
 >|diff|
 --- object.c	(revision 28759)
 +++ object.c	(working copy)
 @@ -1542,7 +1542,7 @@
  rb_class_new_instance(int argc, VALUE *argv, VALUE klass)
  {
      VALUE obj;
 
 +    printf("rb_class_new_instance %s\n", rb_class2name(klass));
      obj = rb_obj_alloc(klass);
      rb_obj_call_init(obj, argc, argv);
 ||<
 
 >||
 irb(main):001:0> 1
 rb_class_new_instance RubyToken::TkINTEGER
 rb_class_new_instance RubyToken::TkNL
 => 1
 irb(main):002:0> x = 1 + "hoge"
 rb_class_new_instance RubyToken::TkIDENTIFIER
 rb_class_new_instance RubyToken::TkSPACE
 rb_class_new_instance RubyToken::TkASSIGN
 rb_class_new_instance RubyToken::TkSPACE
 rb_class_new_instance RubyToken::TkINTEGER
 rb_class_new_instance RubyToken::TkSPACE
 rb_class_new_instance RubyToken::TkPLUS
 rb_class_new_instance RubyToken::TkSPACE
 rb_class_new_instance RubyToken::TkSTRING
 rb_class_new_instance RubyToken::TkNL
 rb_class_new_instance NoMethodError
 rb_class_new_instance TypeError
 TypeError: String can't be coerced into Fixnum
 	from (irb):2:in `+'
 	from (irb):2
 	from bin/irb:12:in `<main>'
 ||<
 
 Interesting. But what I wanted to do is display the creation of integer and string objects.
 </body>
 <comments>
 <comment>
 <username>ujihisa</username>
 <body>It's OK if you don't go through irb. I think RubyToken::TkNL and others are generated by irb</body>.
 <timestamp>1281850314</timestamp>
 </comment>
 <comment>
 <username>nishiohirokazu</username>
 <body>No, it's fine to get tokens, because that's interesting in itself, but strings and integers don't go through this path... </body>
 <timestamp>1281883387</timestamp>
 </comment>
 </comments>

[Hatena Diary 2010-08-15 https://nishiohirokazu.hatenadiary.org/archive/2010/08/15]