{
  "id": "5b17387f93c7f90014130a93",
  "title": "Scrapboxでブックマークレットを作る",
  "created": 1528248451,
  "updated": 1528253539,
  "lines": [
    {
      "id": "5b17387f93c7f90014130a93",
      "text": "Scrapboxでブックマークレットを作る",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528248451,
      "updated": 1528248456
    },
    {
      "id": "5b173e02aff09e0000442f44",
      "text": " ブックマークレットは、プログラミングに入門する良い機会",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528249860,
      "updated": 1528249870
    },
    {
      "id": "5b173e0daff09e0000442f45",
      "text": " \t「ちょっと書いたら日々の作業が楽になる」",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528249870,
      "updated": 1528249893
    },
    {
      "id": "5b173e16aff09e0000442f46",
      "text": "\tしかし制約が厳しいせいで見た目がわかりにくい、余計な認知的負担",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528249880,
      "updated": 1528249935
    },
    {
      "id": "5b173e2faff09e0000442f48",
      "text": "\t 1行にしなければいけない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528249904,
      "updated": 1528249908
    },
    {
      "id": "5b173e33aff09e0000442f4a",
      "text": "  URLエンコードしなければならない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528249908,
      "updated": 1528249918
    },
    {
      "id": "5b173e5eaff09e0000442f4b",
      "text": "\tScrapboxを使うときれいな見た目のままブックマークレットにできる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528249952,
      "updated": 1528249964
    },
    {
      "id": "5b173e6daff09e0000442f4c",
      "text": " \tScrapboxはページ内のソースコードを返すAPIを持っている",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528249966,
      "updated": 1528250125
    },
    {
      "id": "5b173f19aff09e0000442f50",
      "text": "  \t`https://scrapbox.io/nishio/test_alert`に書かれたソースコードが`https://scrapbox.io/api/code/nishio/test_alert/script.js`で得られる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250139,
      "updated": 1528250183
    },
    {
      "id": "5b173f40aff09e0000442f51",
      "text": "   このURLをsrcとするscriptタグをbodyに追加するブックマークレットを作る",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250178,
      "updated": 1528250229
    },
    {
      "id": "5b173f87aff09e0000442f59",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250249,
      "updated": 1528250249
    },
    {
      "id": "5b173f7baff09e0000442f53",
      "text": "指定URLをsrcとするscriptタグをbodyに追加するコード",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250237,
      "updated": 1528250262
    },
    {
      "id": "5b173f7baff09e0000442f54",
      "text": "code::",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250237,
      "updated": 1528250237
    },
    {
      "id": "5b173f7baff09e0000442f55",
      "text": " var url=\"https://scrapbox.io/api/code/nishio/test_alert/script.js\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250237,
      "updated": 1528250237
    },
    {
      "id": "5b173f7baff09e0000442f56",
      "text": " var elm=document.createElement('script');",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250237,
      "updated": 1528250237
    },
    {
      "id": "5b173f7baff09e0000442f57",
      "text": " elm.setAttribute('src', url);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250237,
      "updated": 1528250237
    },
    {
      "id": "5b173f7baff09e0000442f58",
      "text": " document.body.appendChild(elm);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250237,
      "updated": 1528250237
    },
    {
      "id": "5b173eeeaff09e0000442f4e",
      "text": "それをブックマークレットにしたもの",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250096,
      "updated": 1528250275
    },
    {
      "id": "5b173f9caff09e0000442f68",
      "text": "code::",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250270,
      "updated": 1528250270
    },
    {
      "id": "5b173f9caff09e0000442f69",
      "text": "\tjavascript: var url=\"https://scrapbox.io/api/code/nishio/test_alert/script.js\"; var elm=document.createElement('script');elm.setAttribute('src', url);document.body.appendChild(elm); ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250270,
      "updated": 1528250280
    },
    {
      "id": "5b173fcaaff09e0000442f6e",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250315,
      "updated": 1528250315
    },
    {
      "id": "5b173fa7aff09e0000442f6c",
      "text": "メリット",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250281,
      "updated": 1528250341
    },
    {
      "id": "5b174005aff09e0000442f71",
      "text": " 修正と実験のサイクルを高速に回すことができる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250375,
      "updated": 1528250379
    },
    {
      "id": "5b17400baff09e0000442f72",
      "text": " \tコードを読みやすい形に保ったまま修正できる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250380,
      "updated": 1528250389
    },
    {
      "id": "5b173ff6aff09e0000442f70",
      "text": " \t1行にしたりする手間がいらない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250360,
      "updated": 1528250407
    },
    {
      "id": "5b174025aff09e0000442f73",
      "text": "  ブックマークレットを編集する作業がいらない。",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250407,
      "updated": 1528250499
    },
    {
      "id": "5b174098aff09e0000442f77",
      "text": "   参照先のスクリプトが変わるから。",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250522,
      "updated": 1528250524
    },
    {
      "id": "5b174081aff09e0000442f76",
      "text": "  \tブックマークレット自体は「この場所のスクリプトを読め」という命令で、それは変わらないから。",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250499,
      "updated": 1528250526
    },
    {
      "id": "5b174c57aff09e00008e2807",
      "text": "\t\tエラーの場所がわかりやすい",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528253529,
      "updated": 1528253536
    },
    {
      "id": "5b174c5faff09e00008e2808",
      "text": "  \t[https://gyazo.com/5bbf9072ea1c401a0e518318d696bab4]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528253536,
      "updated": 1528253539
    },
    {
      "id": "5b174c61aff09e00008e2809",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528253539,
      "updated": 1528253539
    },
    {
      "id": "5b1740a1aff09e0000442f78",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250530,
      "updated": 1528250530
    },
    {
      "id": "5b173fa4aff09e0000442f6b",
      "text": "デメリット",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250278,
      "updated": 1528250534
    },
    {
      "id": "5b1740a6aff09e0000442f79",
      "text": "\t一部のサービスがこのタイプのブックマークレットを受け付けない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250536,
      "updated": 1528250739
    },
    {
      "id": "5b174173aff09e0000442f7b",
      "text": " \tFacebook",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250740,
      "updated": 1528250743
    },
    {
      "id": "5b1740bfaff09e0000442f7a",
      "text": "  Content Security Policyでスクリプト読み込みに制限をかけていて、そのホワイトリストにScrapboxが含まれていない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250560,
      "updated": 1528250637
    },
    {
      "id": "5b173aebaff09e00008e27dd",
      "text": " \t`Refused to load the script 'https://scrapbox.io/api/code/nishio/test_alert/script.js' because it violates the following Content Security Policy directive: \"script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' *.atlassolutions.com blob: data: 'self'\".`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528249069,
      "updated": 1528250592
    },
    {
      "id": "5b173b3aaff09e00008e27df",
      "text": "\t\tFlickrも同様",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528249148,
      "updated": 1528250756
    },
    {
      "id": "5b17417aaff09e0000442f7d",
      "text": "  `Refused to load the script 'https://scrapbox.io/api/code/nishio/test_alert/script.js' because it violates the following Content Security Policy directive: \"script-src 'unsafe-eval' 'unsafe-inline' 'nonce-bace3aa55f7817dc19e2c90e7f842c1e' https://*.flickr.com https://s.yimg.com https://cdn.yahooapis.com https://yui-s.yahooapis.com https://de.adserver.yahoo.com https://fc.yahoo.com https://radar.cedexis.com https://*.braintreegateway.com https://*.sandbox.paypal.com https://*.paypal.com https://*.paypalobjects.com\".`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250747,
      "updated": 1528250763
    },
    {
      "id": "5b17420daff09e0000442f7f",
      "text": "  どちらのケースもunsafe-evalはついているから、xhrで取ってからevalするブックマークレットを作ればよいか？？",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250895,
      "updated": 1528250925
    },
    {
      "id": "5b174257aff09e0000442f82",
      "text": "  \txhrでGETする部分で同様にはじかれてしまう",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528250968,
      "updated": 1528251428
    },
    {
      "id": "5b174415aff09e0000442f90",
      "text": "    code::",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528251415,
      "updated": 1528251415
    },
    {
      "id": "5b174415aff09e0000442f91",
      "text": "     var url = \"https://scrapbox.io/api/code/nishio/test_alert/script.js\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528251415,
      "updated": 1528251415
    },
    {
      "id": "5b174415aff09e0000442f92",
      "text": "     var oReq = new XMLHttpRequest();",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528251415,
      "updated": 1528251415
    },
    {
      "id": "5b174415aff09e0000442f93",
      "text": "     oReq.addEventListener(\"load\", (x)=>{eval(x.target.response));",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528251415,
      "updated": 1528251415
    },
    {
      "id": "5b174415aff09e0000442f94",
      "text": "     oReq.open(\"GET\", url);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528251415,
      "updated": 1528251415
    },
    {
      "id": "5b174415aff09e0000442f95",
      "text": "     oReq.send();",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528251415,
      "updated": 1528251415
    },
    {
      "id": "5b174415aff09e0000442f97",
      "text": "    `javascript: var url = \"https://scrapbox.io/api/code/nishio/test_alert/script.js\";var oReq = new XMLHttpRequest();oReq.addEventListener(\"load\", (x)=>{eval(x.target.response)});oReq.open(\"GET\", url);oReq.send();`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528251415,
      "updated": 1528251415
    },
    {
      "id": "5b174415aff09e0000442f98",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528251415,
      "updated": 1528251415
    },
    {
      "id": "5b174290aff09e0000442f83",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1528251026,
      "updated": 1528251026
    }
  ]
}