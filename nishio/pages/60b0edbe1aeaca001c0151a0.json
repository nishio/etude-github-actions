{
  "id": "60b0edbe1aeaca001c0151a0",
  "title": "見える文字数カウンター",
  "created": 1622207955,
  "updated": 1622207998,
  "lines": [
    {
      "id": "60b0edbe1aeaca001c0151a0",
      "text": "見える文字数カウンター",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207955,
      "updated": 1622207987
    },
    {
      "id": "60b0edd2aff09e0000c24acc",
      "text": "from [/scrasobox/見える文字数カウンター]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207955,
      "updated": 1622207998
    },
    {
      "id": "60b0edd3aff09e0000c24acd",
      "text": "---",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207955,
      "updated": 1622207960
    },
    {
      "id": "60b0edd3aff09e0000c24ace",
      "text": "code:style.css",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24acf",
      "text": " /* カウンターのスタイル */",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ad0",
      "text": " #__charCounter__ span {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ad1",
      "text": "   cursor: pointer; font: 88%/1 monospace; ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ad2",
      "text": "   opacity: .35; /* ←マウスを乗せてないときの濃さ 35% */",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ad3",
      "text": "   transition: opacity .2s ease-out }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ad4",
      "text": " #__charCounter__ span:hover { opacity: 1 } /* ←マウスを乗せたときの濃さ 100% */",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ad5",
      "text": " #__charCounter__ { z-index: 30; position: sticky; bottom: 0; text-align: right }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ad6",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ad7",
      "text": " /* ポップアップのスタイル */",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ad8",
      "text": " #__charCounterPopup__ {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ad9",
      "text": "   z-index: 30; position: absolute; bottom: 2em; right: -1em;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ada",
      "text": "   border-radius: .25em; border: 1px solid #ddd; box-shadow: 0 0 8px 1px rgba(8,8,8,.1);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24adb",
      "text": "   padding: .8em; background-color: azure; color: #5F9EA0; font: 13.5px/1.4 monospace;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24adc",
      "text": "   transition: opacity .3s ease-out }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24add",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ade",
      "text": " /* プレゼンモードのときは非表示にする */",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24adf",
      "text": " .presentation #__charCounter__,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ae0",
      "text": " .presentation #__charCounterPopup__ { display: none }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ae1",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ae2",
      "text": "code:script.js",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ae3",
      "text": " const __appliedProject__ = scrapbox.Project.name",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ae4",
      "text": " const __charCounterSetup__ = setInterval(function() {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ae5",
      "text": "   ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ae6",
      "text": "   // ページが準備できるのを待ちたいので、スクリプトがロードされてから3秒くらいしたら処理開始↓↓",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ae7",
      "text": "   if (document.getElementById('editor') && scrapbox.Page.lines)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ae8",
      "text": "     clearInterval(__charCounterSetup__)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24ae9",
      "text": "   else",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24aea",
      "text": "     return // ページの準備ができてないときはまた3秒待つ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24aeb",
      "text": "   ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24aec",
      "text": "   // 下準備",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24aed",
      "text": "   const $id = id => document.getElementById(id)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24aee",
      "text": "   const $query = q => document.querySelector(q)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24aef",
      "text": "   const fmt = n => new Intl.NumberFormat('en-US').format(n).padStart(6)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24af0",
      "text": "   ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24af1",
      "text": "   // 文字数カウンター表示用のエレメントを作ってく",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24af2",
      "text": "   const linesText = $query('.lines').innerText.trim()",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24af3",
      "text": "   const chars = linesText.split(/\\s+/).join('').length",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24af4",
      "text": "   var counterWrapper = document.createElement('div')",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24af5",
      "text": "   counterWrapper.id = '__charCounter__'",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24af6",
      "text": "   counterWrapper.innerHTML = `<span>${fmt(chars)} chars</span>` +",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24af7",
      "text": "       '<pre id=\"__charCounterPopup__\" style=\"opacity:0\"></pre>'",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24af8",
      "text": "   $id('editor').appendChild(counterWrapper)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24af9",
      "text": "   ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24afa",
      "text": "   const counter = $query('#__charCounter__ span')",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24afb",
      "text": "   const popup = $id('__charCounterPopup__')",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24afc",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24afd",
      "text": "   // 文字数カウンターにマウスカーソルを乗せたときに詳細をポップアップする",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24afe",
      "text": "   counter.addEventListener('mouseover',",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24aff",
      "text": "       function() {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b00",
      "text": "         const linesText = $query('.lines').innerText.trim()",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b01",
      "text": "         const chars = linesText.split(/\\s+/).join('').length",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b02",
      "text": "         const words = linesText.split(/\\s+/).length",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b03",
      "text": "   ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b04",
      "text": "         popup.innerHTML = `${fmt(chars)} chars\\n` +",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b05",
      "text": "             `${fmt(words)} words\\n` +",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b06",
      "text": "             `${fmt(scrapbox.Page.lines.length)} lines`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b07",
      "text": "         popup.style.opacity = 1",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b08",
      "text": "       })",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b09",
      "text": "   ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b0a",
      "text": "   // 文字数カウンターからマウスカーソルが離れたら詳細ポップアップを見えなくする",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b0b",
      "text": "   counter.addEventListener('mouseout', function() { popup.style.opacity = 0 })",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b0c",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b0d",
      "text": "   // 文字数のみを数え直す関数",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b0e",
      "text": "   const updateCounter = function() {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b0f",
      "text": "     if ($query('.presentation')",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b10",
      "text": "         || scrapbox.Project.name !== __appliedProject__) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b11",
      "text": "       ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b12",
      "text": "       // プレゼンモードになってたり、よそのプロジェクトを表示してたら文字数カウンターを非表示にする",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b13",
      "text": "       counterWrapper.style.display = 'none'",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b14",
      "text": "     } else if (scrapbox.Page.lines) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b15",
      "text": "       ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b16",
      "text": "       // ここで数え直ししてます",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b17",
      "text": "       const linesText = $query('.lines').innerText.trim()",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b18",
      "text": "       const chars = linesText.split(/\\s+/).join('').length",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b19",
      "text": "       counter.innerText = `${fmt(chars)} chars`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b1a",
      "text": "       counterWrapper.style.display = 'block'",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b1b",
      "text": "     }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b1c",
      "text": "   }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b1d",
      "text": "   ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b1e",
      "text": "   // 数え直すタイミングは、テキスト入力時とペースト時",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b1f",
      "text": "   $id('text-input').addEventListener('input', updateCounter)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b20",
      "text": "   $id('text-input').addEventListener('paste', updateCounter)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b21",
      "text": "   ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b22",
      "text": "   // 何もしなくても3秒ごとに数え直す",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b23",
      "text": "   setInterval(updateCounter, 3000)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b24",
      "text": " }, 3000)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    },
    {
      "id": "60b0edd3aff09e0000c24b25",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1622207956,
      "updated": 1622207956
    }
  ]
}