{
  "id": "6090ec0aa287e6002291a219",
  "title": "Hatena2012-04-20",
  "created": 1334847600,
  "updated": 1334847600,
  "lines": [
    {
      "id": "6090ec2daff09e00003db819",
      "text": "Hatena2012-04-20",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db81a",
      "text": "code:hatena",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db81b",
      "text": " <body>",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db81c",
      "text": " *1334857551*Alloyで言語女子会殺人事件",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db81d",
      "text": " 事件: PHPが殺されました",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db81e",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db81f",
      "text": " ** 状況設定",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db820",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db821",
      "text": " PHP, Python, Ruby, Perlは仲良し四人組。PHPが殺された当日もその4人が一緒にいるのが目撃されている。しかしなんか諸般の事情で全員に殺害動機はあるらしい。Perlは友人が殺されたショックで寝込んでいるのでまずはRubyとPythonに事情聴取することにした。警部はAlloy。Alloyについては<a href='http://d.hatena.ne.jp/nishiohirokazu/20120410/1334024972'>Alloyまとめ</a>を参照。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db822",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db823",
      "text": " ** Rubyを事情聴取",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db824",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db825",
      "text": " Ruby: 犯人は私ではないわ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db826",
      "text": " Alloy: 私はそんなことは主張していないわ。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db827",
      "text": " Ruby: 犯人はPythonよ。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db828",
      "text": " Alloy: どうしてそう思うの？",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db829",
      "text": " Ruby: 最初、私とPython、PHPの3人で裏山に行く予定だったのよ。でも私は家の都合で買い物に行かなきゃいけなくなったの。Perlはなんか採集するとかで海岸に行くって言ってたからPHPと一緒にいたのはPythonだけよ。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db82a",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db82b",
      "text": " ** Pythonを事情聴取",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db82c",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db82d",
      "text": " Python: 犯人は私ではないわ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db82e",
      "text": " Alloy: 私はそんなことは主張していないわ。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db82f",
      "text": " Python: 犯人はRubyよ。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db830",
      "text": " Alloy: どうしてそう思うの？",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db831",
      "text": " Python: だって私達が裏山に行くって聞いた後、PHPは一人で買い物に行くって言ってたもの。Rubyがその後で私とPHPに買い物に行くって言ったから犯行当時PHPと一緒にいたのはRubyよ。Perlは真珠を探すとか言って海岸に行ったからRubyにしか犯行はできないわ。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db832",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db833",
      "text": " ** 問題",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db834",
      "text": " Alloy: PythonとRubyがお互いに相手を犯人だと思う事例を探せ、って言われて私が考えたのがこういうシチュエーションなんだけど。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db835",
      "text": " PHP: なんで私が殺され役…",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db836",
      "text": " Alloy: 誰が犯人だと思う？",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db837",
      "text": " JS: えー、RubyとPythonとどっちかが嘘を付いているのかなー？",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db838",
      "text": " Alloy: どちらも嘘はついていないわ。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db839",
      "text": " JS: 犯人がPython、Ruby、Perlの他にいたりする？",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db83a",
      "text": " Alloy: それもないわ。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db83b",
      "text": " JS: じゃあPythonもRubyも自分は犯人じゃないって言ってるんだからPerlが犯人じゃん？",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db83c",
      "text": " Alloy: …しまった！制約を満たすことばっかり考えてて問題の難易度のことは忘れてた！",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db83d",
      "text": " JS: 答えを出すのに必要ないけど、誰にも言わずにどこかに行くことはある？",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db83e",
      "text": " Alloy: ないわ。途中で気が変わることはあるけども、全員最終的に行こうと思ったところを誰かに伝えて、言ったとおりにその場所にいった設定になっているわ。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db83f",
      "text": " JS: じゃあ、まだ観測されていないPHPの発言があるわね。まだ観測されていないってことは聞き手はPerl一人ということかな。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db840",
      "text": " Alloy: そうなるわね。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db841",
      "text": " JS: PHPが買い物にも裏山にも言ってないということは、その2つの発言より後に気が変わって「海岸に行く」とPerlに伝えているはずね。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db842",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db843",
      "text": " ** 解決編",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db844",
      "text": " Alloy: あなたがPHPに「買い物に行く」って聞いた時、その場にRubyはいたの？",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db845",
      "text": " Python: え、うーん、そういえば職員室に呼ばれてたんだっけ。Rubyはいなかったわね。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db846",
      "text": " Ruby: そうよ、買い物に行くなんて聞いてないわ。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db847",
      "text": " Alloy: つまり、RubyはPHPがPythonに「買い物に行く」と伝えたことを知らなかったので、先ほどのように答えるのはしかたない。何も嘘はついていない。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db848",
      "text": " Ruby: じゃあPythonが犯人よ！",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db849",
      "text": " Python: PHPは私に買い物に行くって言ったし、実際に裏山には来なかったのよ。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db84a",
      "text": " Alloy: でも、それはPHPが買い物に行ったことを意味しないわね。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db84b",
      "text": " Python: そうか…",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db84c",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db84d",
      "text": " ** 解答",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db84e",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db84f",
      "text": " -1: PHP, Python, Ruby が Perlに裏山へ行くと伝える",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db850",
      "text": " -2: Rubyが不在、PHPがPython, Perlに買い物に行くと伝える",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db851",
      "text": " -3: PerlはPython, Rubyに海岸へ行くと伝える。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db852",
      "text": " -4: PHPはその後Perlにメールでやっぱ海岸に行くと伝える",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db853",
      "text": " -5: RubyはPythonとPHPに買い物に行くと伝える",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db854",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db855",
      "text": " Rubyは1,3,5しか知らない。Pythonは1,2,3,5を知っている。この知識の違いによってお互いに相手が犯人だと思う事例が発生した。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db856",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db857",
      "text": " ** まとめ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db858",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db859",
      "text": " というわけでミステリーのタネをAlloyで生成できないかに挑戦してみた結果、なんかそれっぽいのはできた。話として面白くするためにはもうちょっとコードに手を加える必要がありそう。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db85a",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db85b",
      "text": " まず「全員正直」って条件が厳しすぎる。「自分が行く場所を他人に必ず伝える」という条件も、とても犯人っぽくない。犯人だけ嘘をつくとかがいいのかもな。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db85c",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db85d",
      "text": " それから、犯人に「自分が犯人だと特定されないようにしよう」という意図が全くない。そもそも「自分が犯人だと特定されない」と思ってすらいない。Perlが犯行に及んだ時点で、Perlは自分が犯人と思われないとか、PythonとRubyがお互いを犯人だと思うであろうとか判断できる根拠を全然持ってない。PerlはRubyとPythonが一緒に裏山に行ってると思ってるからね。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db85e",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db85f",
      "text": " 複数の人間の「誤解」や「相互不信」が起きる事例をAlloyで導出できたのは面白かった。今後もっと面白いことができそうな予感。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db860",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db861",
      "text": " ** コード",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db862",
      "text": " 今回は第二次誤信念は扱っていないけど「自分に都合がいいように他人が誤解するように嘘の情報を流す」ということを犯人がやるためには他人の信念に対する信念が必要であって、しかも犯人は完璧に成功したつもりでいるけどもミスがあってそこからほころびるわけだから第二次誤信念だよね。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db863",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db864",
      "text": " あとソースコードはもうちょっと綺麗にする余地がありそう。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db865",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db866",
      "text": " あっ、読者が誤解をすることをモデリングしようとしてObserverを作ったのに結局使ってないや。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db867",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db868",
      "text": " 関数same_place :: Person -> Person -> Personが割と誤解しそうな名前で、same_place[A, X] = Bは「Aが『Xと一緒にいた』と考える人の集合はB一人だけの集合」って意味になっている。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db869",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db86a",
      "text": " https://github.com/nishio/learning_alloy/blob/master/mardar.als",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db86b",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db86c",
      "text": " >||",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db86d",
      "text": " open util/ordering[Time]",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db86e",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db86f",
      "text": " abstract sig AbsPerson {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db870",
      "text": " \t//観察者も含めた人物",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db871",
      "text": " \tbelief: Person -> Person -> Place -> Time,",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db872",
      "text": " }",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db873",
      "text": " sig Observer extends AbsPerson {}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db874",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db875",
      "text": " //登場人物",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db876",
      "text": " abstract sig Person extends AbsPerson{",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db877",
      "text": " \t// 最終的にどこへ行ったか",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db878",
      "text": " \treal_place: Place -> Time",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db879",
      "text": " }{",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db87a",
      "text": " \tall t: Time | lone real_place.t",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db87b",
      "text": " }",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db87c",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db87d",
      "text": " one sig X extends Person{}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db87e",
      "text": " one sig A extends Person{}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db87f",
      "text": " one sig B extends Person{}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db880",
      "text": " one sig C extends Person{}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db881",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db882",
      "text": " sig Time {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db883",
      "text": " \t// 各時刻に誰かが誰かに自分がどこに行くかを伝える",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db884",
      "text": " \twho: some Person,",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db885",
      "text": " \ttargets: some AbsPerson,",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db886",
      "text": " \twhere: Place",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db887",
      "text": " }{",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db888",
      "text": " \t// 話し手は聞き手に含まれる",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db889",
      "text": " \twho in targets",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db88a",
      "text": " \t// 聞き手が話し手と同一ではいけない",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db88b",
      "text": " \tsome targets - Observer - who",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db88c",
      "text": " }",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db88d",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db88e",
      "text": " sig Place {}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db88f",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db890",
      "text": " fact {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db891",
      "text": " \t// 同じ人が複数箇所に存在すると信じることはない",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db892",
      "text": " \tall p1, p2, p3: Person, t: Time{",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db893",
      "text": " \t\tlone (p1.belief)[p2, p3].t",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db894",
      "text": " \t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db895",
      "text": " }",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db896",
      "text": " // whoと同じ場所にいた可能性があるのは？",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db897",
      "text": " fun same_place(self: AbsPerson, who: Person): Person{",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db898",
      "text": " \tlet where = self.(self.belief).last {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db899",
      "text": " \t\twho.where.~where + {p: Person | no p.where} - who",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db89a",
      "text": " \t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db89b",
      "text": " }",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db89c",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db89d",
      "text": " pred init(t: Time){",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db89e",
      "text": " \tall p: AbsPerson {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db89f",
      "text": " \t\tno p.belief.t",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8a0",
      "text": " \t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8a1",
      "text": " \tall p: Person {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8a2",
      "text": " \t\tno p.real_place.t",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8a3",
      "text": " \t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8a4",
      "text": " }",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8a5",
      "text": " pred step(t', t: Time){",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8a6",
      "text": " \tall p: Person {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8a7",
      "text": " \t\t(p in t.targets) => {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8a8",
      "text": " \t\t\t// 聞いた人の信念が上書きされる",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8a9",
      "text": " \t\t\tp.belief[p].t = p.belief[p].t' ++ (t.who -> t.where)",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8aa",
      "text": " \t\t\t// 第二次誤信念は今回は扱わない",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8ab",
      "text": " \t\t\tno p.belief[Person - p].t",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8ac",
      "text": " \t\t}else{",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8ad",
      "text": " \t\t\tp.belief.t = p.belief.t'",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8ae",
      "text": " \t\t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8af",
      "text": " \t\t(p in t.who) => {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8b0",
      "text": " \t\t\t// 自分が言ったところに行く(嘘はつかない)",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8b1",
      "text": " \t\t\tp.real_place.t = t.where",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8b2",
      "text": " \t\t}else{",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8b3",
      "text": " \t\t\tp.real_place.t = p.real_place.t'",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8b4",
      "text": " \t\t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8b5",
      "text": " \t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8b6",
      "text": " }",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8b7",
      "text": " pred final(t', t: Time){",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8b8",
      "text": " \tall p: Person {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8b9",
      "text": " \t\tlet go = real_place.t',",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8ba",
      "text": " \t\t\t\tplace = p.go, ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8bb",
      "text": " \t\t\t\tmeets = go.place {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8bc",
      "text": " \t\t\t// 最終的にどこかには行った",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8bd",
      "text": " \t\t\tone place",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8be",
      "text": " \t\t\tp.real_place.last = place",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8bf",
      "text": " \t\t\t// 最終的に同じ場所に行った人は信念が更新される",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8c0",
      "text": " \t\t\tp.belief[p].t = p.belief[p].t' ++ (meets -> place)",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8c1",
      "text": " \t\t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8c2",
      "text": " \t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8c3",
      "text": " }",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8c4",
      "text": " run {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8c5",
      "text": " \tinit[first]",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8c6",
      "text": " \tall t: Time - last - first{",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8c7",
      "text": " \t\tstep[t.prev, t]",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8c8",
      "text": " \t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8c9",
      "text": " \tfinal[last.prev, last]",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8ca",
      "text": " \t// AはBが犯人だと、BはAが犯人だと考えている",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8cb",
      "text": " \tsame_place[A, X] = B",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8cc",
      "text": " \tsame_place[B, X] = A",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8cd",
      "text": " \t// 二人ともアリバイはないが自分が犯人ではない",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8ce",
      "text": " \tno same_place[A, A]",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8cf",
      "text": " \tno same_place[B, B]",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8d0",
      "text": " \t// Cは自分が犯人だと知っている",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8d1",
      "text": " \tsame_place[C, X] = C",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8d2",
      "text": " } for 7 Time, 3 Place, 1 Observer",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8d3",
      "text": " ||<",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8d4",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8d5",
      "text": " *1334902176*Alloyでピーターソンのアルゴリズム",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8d6",
      "text": " >>",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8d7",
      "text": " ピーターソンのアルゴリズムは、通信のために共有メモリだけを使い「2個」のプロセス間でリソースを競合することなく共有する相互排他のためのアルゴリズムである。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8d8",
      "text": " <<",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8d9",
      "text": " <a href='http://ja.wikipedia.org/wiki/%E3%83%94%E3%83%BC%E3%82%BF%E3%83%BC%E3%82%BD%E3%83%B3%E3%81%AE%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0'>ピーターソンのアルゴリズム - Wikipedia</a>",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8da",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8db",
      "text": " Alloyでモデリングしてみた。 https://github.com/nishio/learning_alloy/blob/master/Peterson.als",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8dc",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8dd",
      "text": " Wikipediaに書いてある「P0とP1は決して同時にクリティカルセクションには入らない。」を検証してみよう。for 15 Timeのスコープで2つのプロセスのプログラムカウンタが同時に3(つまりクリティカルセクション内)にならないことを検証させる。反例は見つからない。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8de",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8df",
      "text": " >||",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8e0",
      "text": " check MutualExclusion {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8e1",
      "text": " \tno t: Time {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8e2",
      "text": " \t\tPC.proc[0].t = 3",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8e3",
      "text": " \t\tPC.proc[1].t = 3",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8e4",
      "text": " \t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8e5",
      "text": " } for 15 Time",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8e6",
      "text": " ||<",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8e7",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8e8",
      "text": " じゃあ「プロセスはクリティカルセクション1回分の処理時間以上に待たされることはない」も検証してみよう。やってみたらさくっと反例が見つかった。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8e9",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8ea",
      "text": " >||",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8eb",
      "text": " check BoundedWaiting_Bad {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8ec",
      "text": " \tno t: Time, pid: Int {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8ed",
      "text": " \t\tPC.proc[pid].t = 2",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8ee",
      "text": " \t\tPC.proc[pid].(t.next) = 2",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8ef",
      "text": " \t\tPC.proc[pid].(t.next.next) = 2",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8f0",
      "text": " \t\tPC.proc[pid].(t.next.next.next) = 2",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8f1",
      "text": " \t\tPC.proc[pid].(t.next.next.next.next) = 2",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8f2",
      "text": " \t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8f3",
      "text": " } for 15 Time",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8f4",
      "text": " ||<",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8f5",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8f6",
      "text": " 理由は割と簡単で「各時刻にどちらかのプロセスが1ステップ実行される」という仕様では「自分は『進める状態』相手が『待たされる状態』で、相手プロセスが5回連続で実行される」が起こりうるから。「各時刻1個につき、ランダムに選ばれた片方のプロセスが1ステップ実行される」という条件ではランダムに選ばれた結果 「待つべき側のプロセスばかり連続して実行される(その結果何も変わらない)」が起こるわけだ。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8f7",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8f8",
      "text": " だからWikipediaの 「プロセスはクリティカルセクション1回分の処理時間以上に待たされることはない」 を文字通りに捉えたのが間違い。たとえば「あるプロセスが待っている間に片方のプロセスが2回連続してクリティカルセクションを実行することはない」とするべき。よし、これならfor 15 Timeのスコープで反例はない。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8f9",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8fa",
      "text": " >||",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8fb",
      "text": " check BoundedWaiting {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8fc",
      "text": " \tno t, t': Time, pid: Int {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8fd",
      "text": " \t\tlet range = Time - t.prevs - t'.nexts {",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8fe",
      "text": " \t\t\t// あるプロセスがずっと2(ロック待ち)で",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db8ff",
      "text": " \t\t\tall t'': range | PC.proc[pid].t'' = 2",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db900",
      "text": " \t\t\t// その間、もう片方のプロセスが2回以上3(クリティカルセクション)を実行",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db901",
      "text": " \t\t\t#{t'': range | ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db902",
      "text": " \t\t\t\tPC.proc[PC.current_pid.t''].t'' = 3",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db903",
      "text": " \t\t\t} >= 2",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db904",
      "text": " \t\t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db905",
      "text": " \t}",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db906",
      "text": " } for 15 Time",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db907",
      "text": " ||<",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db908",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db909",
      "text": " ** アウトオブオーダー実行",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db90a",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db90b",
      "text": " さてさて、ここからが本題なのだが、ピーターソンのアルゴリズムは命令が書かれた順序で実行されることを想定している。現代のCPUはそうではない((<a href='http://ja.wikipedia.org/wiki/%E3%82%A2%E3%82%A6%E3%83%88%E3%83%BB%E3%82%AA%E3%83%96%E3%83%BB%E3%82%AA%E3%83%BC%E3%83%80%E3%83%BC%E5%AE%9F%E8%A1%8C'>アウト・オブ・オーダー実行 - Wikipedia</a>))。だから現代のCPUで動くようにするには適切にフェンスを置く必要がある((<a href='http://ja.wikipedia.org/wiki/%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%90%E3%83%AA%E3%82%A2'>メモリバリア - Wikipedia</a>))。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db90c",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db90d",
      "text": " で、光成さん((<a href='http://homepage1.nifty.com/herumi/'>With Unz</a>))に色々教えてもらいながらgcc -S -O3 -fomit-frame-pointer tmp.cしたり#include <emmintrin.h>して_mm_mfence();したり「<a href='http://d.hatena.ne.jp/bsdhouse/20101016/1287227939'>ピーターソンのアルゴリズムとメモリバリア - yamasaのネタ帳</a>のコードのlockの中のwhileの前にmfenceをおいたら僕のMacBook AirのCore 2 Duoでは問題なく動くようになった。sfenceでも動くけどlfenceだと動かない。なるほど！と思ったら別のCPUだと逆にsfenceが動かなくてlfenceが動くぞ！これはたまたま動いているだけか！これじゃ実機で実行してみて問題が見つからなくても全然安心できないじゃないか！」と騒いだりした。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db90e",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db90f",
      "text": " というわけで実機で試しても何も安心できないので、今後Alloyでアウトオブオーダー実行をモデリングしようと思うんだけど、とりあえず手始めに0行目と1行目のstoreが入れ替わったらどうなるか試してみたらさくっと2.5秒でクリティカルセクションに両方が入る反例が見つかった。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db910",
      "text": " >||",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db911",
      "text": " Time$1: pc0=0, pc1=1, pid=1 turn=0 f0=0 f1=0 // p1がturnを0にする ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db912",
      "text": " Time$2: pc0=1, pc1=1, pid=0 turn=1 f0=0 f1=0 // p0がturnを1にする ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db913",
      "text": " Time$3: pc0=2, pc1=1, pid=0 turn=1 f0=1 f1=0 // p0がf1==0だから「p1は待っていない」と判断、進入 ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db914",
      "text": " Time$4: pc0=3, pc1=1, pid=0 turn=1 f0=1 f1=0 ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db915",
      "text": " Time$5: pc0=3, pc1=2, pid=1 turn=1 f0=1 f1=1 // p1が「turnが1だから俺が進んでよい」と判断、進入 ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db916",
      "text": " Time$6: pc0=3, pc1=3, pid=1 turn=1 f0=1 f1=1 // ここで両方ともクリティカルセクション(pc=3)にいる ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db917",
      "text": " Time$7: pc0=3, pc1=0, pid=1 turn=1 f0=1 f1=0 ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db918",
      "text": " Time$8: pc0=0, pc1=0, pid=0 turn=1 f0=0 f1=0 ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db919",
      "text": " Time$9: pc0=1, pc1=0, pid=0 turn=1 f0=0 f1=0",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db91a",
      "text": " ||<",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db91b",
      "text": " だから0行目と1行目の間には最低限sfenceは必要なわけだな。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db91c",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db91d",
      "text": " 追記: 「sfenceが必要」と書いたのは言いたかったことを正確に表現できていないということがわかった。see <a href='http://homepage1.nifty.com/herumi/diary/1204.html#21'>melancholic afternoon</a>。「アウトオブオーダー実行でW→Wの順序を入れ替える可能性のあるCPUでピーターソンのアルゴリズムを動かす場合、0行目と1行目の間にはW→Wの順序を保つ制約を入れる必要がある」と言うべきだった。Core 2 Duo, Atom, Core Duo, Pentium 4, P6ではW→Wの順序は(一部の命令を除いて)保存されるのでsfenceを入れる必要もないようだ。",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db91e",
      "text": " ",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db91f",
      "text": " 次回予定: 「Alloyでアウトオブオーダー実行」",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db920",
      "text": " </body>",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db921",
      "text": "",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    },
    {
      "id": "6090ec2daff09e00003db922",
      "text": "[はてなダイアリー 2012-04-20 https://nishiohirokazu.hatenadiary.org/archive/2012/04/20]",
      "created": 1334847600,
      "updated": 1334847600,
      "userId": "582e63d27c56960011aff09e"
    }
  ]
}