{
  "id": "60f679ed260a82001c065337",
  "title": "2021-07-20Movidea開発日記",
  "created": 1626765810,
  "updated": 1629299387,
  "lines": [
    {
      "id": "60f679ed260a82001c065337",
      "text": "2021-07-20Movidea開発日記",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626765810,
      "updated": 1629299387
    },
    {
      "id": "60fe5577aff09e00006535d0",
      "text": "prev [2021-07-19Movidea開発日記]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1627280760,
      "updated": 1629299399
    },
    {
      "id": "60f7e62eaff09e00003d2fc7",
      "text": "[https://gyazo.com/f8bac0032f9b9fc356ffc5b1c9a95184]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626859055,
      "updated": 1626859059
    },
    {
      "id": "60f7e632aff09e00003d2fc9",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626859059,
      "updated": 1626859059
    },
    {
      "id": "60f7e62faff09e00003d2fc8",
      "text": "---",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626859055,
      "updated": 1626859058
    },
    {
      "id": "60f679f3aff09e0000c986fa",
      "text": "マウスイベント周りの問題、前回Regroupの時はかなり複雑になってから自覚したのでしっかり理解することができなかったが、今回は理解できた",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626765811,
      "updated": 1626766231
    },
    {
      "id": "60f67bbbaff09e0000c986fc",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626766267,
      "updated": 1626766267
    },
    {
      "id": "60f67bbbaff09e0000c986fd",
      "text": "[https://gyazo.com/eff9b3ce1c710834d545360b4c3fecd3]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626766267,
      "updated": 1626766268
    },
    {
      "id": "60f67bbcaff09e0000c986fe",
      "text": "人間にとって好ましい、自然な、「意味の塊」は左のようなもの",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626766268,
      "updated": 1626766381
    },
    {
      "id": "60f67d34aff09e0000c98700",
      "text": "　グループのドラッグでの移動",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626766645,
      "updated": 1626766657
    },
    {
      "id": "60f67d40aff09e0000c98701",
      "text": "　範囲選択",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626766657,
      "updated": 1626766660
    },
    {
      "id": "60f67d44aff09e0000c98702",
      "text": "　選択範囲のドラッグでの移動",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626766660,
      "updated": 1626766667
    },
    {
      "id": "60f67d4baff09e0000c98703",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626766667,
      "updated": 1626766668
    },
    {
      "id": "60f67c2daff09e0000c986ff",
      "text": "しかし現実にはブラウザの仕様によって",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626766382,
      "updated": 1626766740
    },
    {
      "id": "60f67d4daff09e0000c98704",
      "text": "　ドラッグでの移動のdropイベントはどちらの場合も共通",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626766669,
      "updated": 1626838825
    },
    {
      "id": "60f67dc0aff09e0000c98705",
      "text": "　どの操作をしててもmousemoveやmouseupは呼び出される(追記: この解釈がそもそも間違いなのを後述)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626766784,
      "updated": 1626838852
    },
    {
      "id": "60f67b6caff09e0000c986fb",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626766188,
      "updated": 1626766188
    },
    {
      "id": "60f67f77aff09e0000c98707",
      "text": "Regroupの時はすべてCanvas要素の上で操作されることもあって全部mousedown開始だった",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626767223,
      "updated": 1626767872
    },
    {
      "id": "60f68200aff09e0000c98709",
      "text": "　[https://gyazo.com/85789af4ab3dcdc611e2080af074c7cb]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626767872,
      "updated": 1626767943
    },
    {
      "id": "60f68248aff09e0000c9870b",
      "text": "　バツ印は「mousedown後、mousemoveが発生せずに、mouseupが発生した時に行う処理」の意味",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626767945,
      "updated": 1626768009
    },
    {
      "id": "60f68291aff09e0000c9870d",
      "text": "　　要するにクリック",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626768018,
      "updated": 1626768022
    },
    {
      "id": "60f6828aaff09e0000c9870c",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626768010,
      "updated": 1626768011
    },
    {
      "id": "60f68200aff09e0000c9870a",
      "text": "そこでこうした",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626767873,
      "updated": 1626767882
    },
    {
      "id": "60f685d9aff09e0000c98712",
      "text": "　ハンドラーオブジェクトに「一塊の処理」をまとめて、mousedownのタイミングでどのハンドラーを使うかを決定",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626768858,
      "updated": 1626768956
    },
    {
      "id": "60f67e1aaff09e0000c98706",
      "text": " [https://gyazo.com/c7c5e860137e7dc2d7aa033be8fca133]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626766874,
      "updated": 1626768856
    },
    {
      "id": "60f685cdaff09e0000c98711",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626768845,
      "updated": 1626768845
    },
    {
      "id": "60f68640aff09e0000c98713",
      "text": "一見良さそうに見えるがダメ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626768961,
      "updated": 1626778812
    },
    {
      "id": "60f6864caff09e0000c98714",
      "text": "　複数のハンドラで共通して行わなければいけない処理がある",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626768973,
      "updated": 1626768990
    },
    {
      "id": "60f6865eaff09e0000c98715",
      "text": "　　それぞれに書いたら漏れが出る",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626768990,
      "updated": 1626769013
    },
    {
      "id": "60f686d9aff09e0000c98719",
      "text": "　　この問題を解決するために「もう一枚レイヤーを挟んで共通で行う処理をまとめて行う」という設計変更が行われた",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626769114,
      "updated": 1626769176
    },
    {
      "id": "60f6867daff09e0000c98716",
      "text": "　mousedownの段階で処理が確定することを暗黙に仮定していた",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626769021,
      "updated": 1626769040
    },
    {
      "id": "60f686c0aff09e0000c98717",
      "text": "　　そうでないケースが扱いにくくなってしまった",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626769089,
      "updated": 1626769099
    },
    {
      "id": "60f6871faff09e0000c9871a",
      "text": "　　　mousedownが来た直後にもう一つmousedownが来てマルチタッチになったら？",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626769183,
      "updated": 1626769217
    },
    {
      "id": "60f68740aff09e0000c9871b",
      "text": "　　　「付箋をグループにドロップすることでグループの中に入れたい」はドロップ時の状況による場合分け",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626769217,
      "updated": 1626769293
    },
    {
      "id": "60f6878caff09e0000c9871c",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626769293,
      "updated": 1626769298
    },
    {
      "id": "60f68bbfaff09e0000c9871d",
      "text": "それを踏まえて今回のこの状況をどう整理すればいいか",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626770367,
      "updated": 1626770383
    },
    {
      "id": "60f685bcaff09e0000c9870e",
      "text": " [https://gyazo.com/eff9b3ce1c710834d545360b4c3fecd3]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626768828,
      "updated": 1626770386
    },
    {
      "id": "60f68bd3aff09e0000c9871e",
      "text": " わかった気がしたがまたわからなくなった…",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626770388,
      "updated": 1626770397
    },
    {
      "id": "60f685bcaff09e0000c98710",
      "text": "　暗黙に状態が発生しているから、それを陽に管理したらいいのでは、と思ったのだった",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626768829,
      "updated": 1626770518
    },
    {
      "id": "60f68fb0aff09e00002f2759",
      "text": "　現状のコードではmousedownでisDraggingフラグを立ててる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626771379,
      "updated": 1626771421
    },
    {
      "id": "60f6903eaff09e00002f275a",
      "text": "　いや、ダメだな、現状の実装で既に「僕の理解」で書いた右の図と実際の振る舞いが違う",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626771522,
      "updated": 1626771554
    },
    {
      "id": "60f69061aff09e00002f275b",
      "text": "　\tmouseDown, mouseMove, dragStart, dropの順で実行されてしまう",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626771554,
      "updated": 1626771820
    },
    {
      "id": "60f69193aff09e00002f275c",
      "text": "　\tその結果フラグが立ちっぱなし",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626771859,
      "updated": 1626771866
    },
    {
      "id": "60f69246aff09e00002f275d",
      "text": "　\t実際の挙動",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626772038,
      "updated": 1626772043
    },
    {
      "id": "60f6924baff09e00002f275e",
      "text": "　\t　[https://gyazo.com/7f89d3da0b90f44e7fc1710c725600a8]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626772043,
      "updated": 1626772045
    },
    {
      "id": "60f6924daff09e00002f275f",
      "text": "　　今回の場合、上の処理の開始位置にある要素はDOM的に下の処理の要素に包含されてるので、mousedownを上にもつけて、そちらでつかんでstopPropagateする手がある",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626772045,
      "updated": 1626778927
    },
    {
      "id": "60f6991daff09e00002f2760",
      "text": "　　　っていうかそれ以外の手がなさそう",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626773789,
      "updated": 1626773798
    },
    {
      "id": "60f69927aff09e00002f2761",
      "text": "　　　要するに、ソースコードにコード上の包含関係に基づくレキシカルスコープがあるのと同様に、DOMにもその包含関係に基づくスコープがあるわけだ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626773799,
      "updated": 1626773858
    },
    {
      "id": "60f69961aff09e00002f2762",
      "text": "　　　そう考えるとmousedownでフラグを立てて、フラグが立ってる時だけmousemoveで特定の処理をするのは動的スコープで時間軸上の区間を切り取ってるのだな",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626773858,
      "updated": 1626773911
    },
    {
      "id": "60f6a924aff09e00002f2763",
      "text": "　　それを図で表現するとこうなる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626777893,
      "updated": 1626777901
    },
    {
      "id": "60f6a92caff09e00002f2764",
      "text": "　　　[https://gyazo.com/3452e6e3fc8f0ba0929872154279528c]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626777901,
      "updated": 1626777902
    },
    {
      "id": "60f6a92daff09e00002f2765",
      "text": "　　これを踏まえて今回必要なことを整理するとこうなる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626777902,
      "updated": 1626778161
    },
    {
      "id": "60f6aa1eaff09e00002f2766",
      "text": "　　　[https://gyazo.com/0c46bca6d85909389dd36c513b665706]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626778142,
      "updated": 1626778144
    },
    {
      "id": "60f6aa20aff09e00002f2767",
      "text": "　　　今回はまだシンプルだから設計できたけど、これもう2〜3件増えたら図に描くことができなくなるよな",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626778144,
      "updated": 1626778235
    },
    {
      "id": "60f685bcaff09e0000c9870f",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626768829,
      "updated": 1626768829
    },
    {
      "id": "60f6adaaaff09e00002f2768",
      "text": "これを踏まえて今回どうするか",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626779051,
      "updated": 1626779056
    },
    {
      "id": "60f6adb0aff09e00002f276a",
      "text": "　あわてて変なレイヤーを入れたりしない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626779056,
      "updated": 1626779076
    },
    {
      "id": "60f6adc6aff09e00002f276b",
      "text": "　あわてて分割しない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626779078,
      "updated": 1626779104
    },
    {
      "id": "60f6adf3aff09e00002f276c",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626779124,
      "updated": 1626779124
    },
    {
      "id": "60f6adf4aff09e00002f276d",
      "text": "「選択範囲の移動」と「グループ内の付箋を外に出す」を実装してテストケースを書いてからリファクタリングする",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626779125,
      "updated": 1626779232
    },
    {
      "id": "60f6adadaff09e00002f2769",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626779053,
      "updated": 1626779053
    },
    {
      "id": "60f7aaccaff09e00003d2faa",
      "text": "---",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843853,
      "updated": 1626843853
    },
    {
      "id": "60f7aacdaff09e00003d2fab",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843854,
      "updated": 1626843854
    },
    {
      "id": "60f77e85aff09e00001efd5a",
      "text": "2021-07-21",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626832517,
      "updated": 1626832521
    },
    {
      "id": "60f77e8aaff09e00001efd5b",
      "text": "一晩寝て気づいたこと",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626832522,
      "updated": 1626832612
    },
    {
      "id": "60f783f2aff09e00001efd60",
      "text": "　選択時に選択対象の要素を移し替えるなら",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626833907,
      "updated": 1626833959
    },
    {
      "id": "60f77ee5aff09e00001efd5e",
      "text": "　選択範囲ができた後、選択範囲の外をクリックしたとき、元に戻さなければならない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626832614,
      "updated": 1626833966
    },
    {
      "id": "60f7842eaff09e00001efd61",
      "text": "　つまりここにも状態が発生している",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626833967,
      "updated": 1626834175
    },
    {
      "id": "60f7a685aff09e000039e13f",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626842759,
      "updated": 1626842759
    },
    {
      "id": "60f7a685aff09e000039e140",
      "text": "状態はテストの対象になるべき",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626842759,
      "updated": 1626842770
    },
    {
      "id": "60f7a93eaff09e000039e142",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843455,
      "updated": 1626843455
    },
    {
      "id": "60f7a6a7aff09e000039e141",
      "text": "今はローカル変数が状態を持っているが、これをグローバルにする",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626842792,
      "updated": 1626843461
    },
    {
      "id": "60f7a953aff09e00003d2f9f",
      "text": "before",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843476,
      "updated": 1626843477
    },
    {
      "id": "60f7a7feaff09e00003d2f36",
      "text": "code:ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843135,
      "updated": 1626843136
    },
    {
      "id": "60f7a7ffaff09e00003d2f37",
      "text": " let isDragging = false;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843136
    },
    {
      "id": "60f7a800aff09e00003d2f38",
      "text": " export const onMouseDown = (...) => {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843427
    },
    {
      "id": "60f7a800aff09e00003d2f3b",
      "text": "   isDragging = true;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843415
    },
    {
      "id": "60f7a817aff09e00003d2f69",
      "text": "   ...",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843160,
      "updated": 1626843160
    },
    {
      "id": "60f7a800aff09e00003d2f3d",
      "text": " };",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843149
    },
    {
      "id": "60f7a800aff09e00003d2f44",
      "text": " export const onMouseMove = (...) => {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843433
    },
    {
      "id": "60f7a800aff09e00003d2f47",
      "text": "   if (isDragging) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843136
    },
    {
      "id": "60f7a800aff09e00003d2f48",
      "text": "     ...",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843417
    },
    {
      "id": "60f7a800aff09e00003d2f49",
      "text": "   }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843153
    },
    {
      "id": "60f7a800aff09e00003d2f4e",
      "text": " };",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843136
    },
    {
      "id": "60f7a800aff09e00003d2f4f",
      "text": " export const onMouseUp = (...) => {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843438
    },
    {
      "id": "60f7a800aff09e00003d2f52",
      "text": "   if (isDragging) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843420
    },
    {
      "id": "60f7a821aff09e00003d2f6a",
      "text": "     ...",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843169,
      "updated": 1626843171
    },
    {
      "id": "60f7a800aff09e00003d2f54",
      "text": "     isDragging = false;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843168
    },
    {
      "id": "60f7a800aff09e00003d2f64",
      "text": "   }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843136
    },
    {
      "id": "60f7a800aff09e00003d2f65",
      "text": " };",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843136
    },
    {
      "id": "60f7a800aff09e00003d2f66",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843136,
      "updated": 1626843173
    },
    {
      "id": "60f7a94aaff09e00003d2f6b",
      "text": "after",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843467,
      "updated": 1626843467
    },
    {
      "id": "60f7a94baff09e00003d2f6d",
      "text": "code:ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843467,
      "updated": 1626843471
    },
    {
      "id": "60f7a94faff09e00003d2f6e",
      "text": " export const onMouseDown = (...) => {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843471,
      "updated": 1626843483
    },
    {
      "id": "60f7a950aff09e00003d2f71",
      "text": "   updateGlobal((g) => {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843484
    },
    {
      "id": "60f7a961aff09e00003d2fa0",
      "text": "     ...",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843489,
      "updated": 1626843490
    },
    {
      "id": "60f7a950aff09e00003d2f73",
      "text": "     g.mouseState = \"selecting\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843487
    },
    {
      "id": "60f7a950aff09e00003d2f78",
      "text": "   });",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843472
    },
    {
      "id": "60f7a950aff09e00003d2f79",
      "text": " };",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843472
    },
    {
      "id": "60f7a950aff09e00003d2f7a",
      "text": " export const onMouseMove = (...) => {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843497
    },
    {
      "id": "60f7a950aff09e00003d2f7d",
      "text": "   const g = getGlobal();",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843472
    },
    {
      "id": "60f7a950aff09e00003d2f7e",
      "text": "   if (g.mouseState === \"selecting\") {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843472
    },
    {
      "id": "60f7a96daff09e00003d2fa1",
      "text": "     ...",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843502,
      "updated": 1626843504
    },
    {
      "id": "60f7a950aff09e00003d2f7f",
      "text": "   }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843501
    },
    {
      "id": "60f7a950aff09e00003d2f85",
      "text": " };",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843472
    },
    {
      "id": "60f7a950aff09e00003d2f86",
      "text": " export const onMouseUp = (...) => {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843508
    },
    {
      "id": "60f7a950aff09e00003d2f89",
      "text": "   const g = getGlobal();",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843509
    },
    {
      "id": "60f7a950aff09e00003d2f8b",
      "text": "   if (g.mouseState === \"selecting\") {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843472
    },
    {
      "id": "60f7a950aff09e00003d2f8c",
      "text": "     updateGlobal((g) => {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843472
    },
    {
      "id": "60f7a97eaff09e00003d2fa2",
      "text": "       ...",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843519,
      "updated": 1626843520
    },
    {
      "id": "60f7a950aff09e00003d2f8d",
      "text": "       g.mouseState = \"selecting\";  // intentional bug, should be \"\"",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843684
    },
    {
      "id": "60f7a950aff09e00003d2f9b",
      "text": "     });",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843472
    },
    {
      "id": "60f7a950aff09e00003d2f9c",
      "text": "   }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843472
    },
    {
      "id": "60f7a950aff09e00003d2f9d",
      "text": " };",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843472
    },
    {
      "id": "60f7a950aff09e00003d2f9e",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843472,
      "updated": 1626843655
    },
    {
      "id": "60f7aa08aff09e00003d2fa3",
      "text": "test",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843656,
      "updated": 1626843658
    },
    {
      "id": "60f7aa09aff09e00003d2fa4",
      "text": "code:test.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843658,
      "updated": 1626843661
    },
    {
      "id": "60f7aa0daff09e00003d2fa5",
      "text": "     cy.get(\"#canvas\").trigger(\"mousedown\", 50, 100);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843661,
      "updated": 1626843661
    },
    {
      "id": "60f7aa0daff09e00003d2fa6",
      "text": "     cy.getGlobal((g) => g.mouseState).should(\"to.eql\", \"selecting\");",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843661,
      "updated": 1626843661
    },
    {
      "id": "60f7aa0daff09e00003d2fa7",
      "text": "     cy.get(\"#canvas\").trigger(\"mouseup\", 300, 400);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843661,
      "updated": 1626843661
    },
    {
      "id": "60f7aa0daff09e00003d2fa8",
      "text": "     cy.getGlobal((g) => g.mouseState).should(\"to.eql\", \"\");  // intentional fail",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843661,
      "updated": 1626843692
    },
    {
      "id": "60f7aa0daff09e00003d2fa9",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843661,
      "updated": 1626843662
    },
    {
      "id": "60f7a94aaff09e00003d2f6c",
      "text": "これでおかしな状態になってる時に検知できるようになった",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843467,
      "updated": 1626843742
    },
    {
      "id": "60f7aa5eaff09e000039e144",
      "text": "　故意のバグはテストがちゃんとこけることを確認してから修正した",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843742,
      "updated": 1626843748
    },
    {
      "id": "60f7aa36aff09e000039e143",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843703,
      "updated": 1626843703
    },
    {
      "id": "60f7ab5caff09e000039e145",
      "text": "昨日の「dragstartの前にmousedownが来ることに気付いてなかった」をテストケースで検証",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843997,
      "updated": 1626844066
    },
    {
      "id": "60f7ab5faff09e000039e146",
      "text": "code:test.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626843999,
      "updated": 1626844041
    },
    {
      "id": "60f7ab86aff09e00003d2fad",
      "text": "     cy.testid(\"1\").trigger(\"dragstart\", \"center\");",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844038,
      "updated": 1626844038
    },
    {
      "id": "60f7ab86aff09e00003d2fae",
      "text": "     cy.getGlobal((g) => g.mouseState).should(\"to.eql\", \"\");",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844038,
      "updated": 1626844038
    },
    {
      "id": "60f7ab86aff09e00003d2faf",
      "text": "     cy.get(\"#canvas\").trigger(\"drop\", 250, 250);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844038,
      "updated": 1626844038
    },
    {
      "id": "60f7ab86aff09e00003d2fb0",
      "text": "これでfailするかと思ったら、しない、なるほど",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844038,
      "updated": 1626844080
    },
    {
      "id": "60f7abafaff09e000039e149",
      "text": "　人間が操作する時には先にmousedownが発生する",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844080,
      "updated": 1626844097
    },
    {
      "id": "60f7abc1aff09e000039e14a",
      "text": "　テストケースではdragstartイベントを発行してるだけだからmousedownが発生しない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844097,
      "updated": 1626844130
    },
    {
      "id": "60f7aba4aff09e000039e147",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844069,
      "updated": 1626844069
    },
    {
      "id": "60f7ac6baff09e000039e14b",
      "text": "これを現実のイベントと同じようにテストするとこうなるか",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844268,
      "updated": 1626844294
    },
    {
      "id": "60f7ac5eaff09e00003d2fb1",
      "text": "code:test.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844255,
      "updated": 1626844260
    },
    {
      "id": "60f7ac63aff09e00003d2fb3",
      "text": "   it(\"is not selecting\", () => {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844260,
      "updated": 1626844260
    },
    {
      "id": "60f7ac64aff09e00003d2fb4",
      "text": "     cy.testid(\"1\").trigger(\"mousedown\", \"center\");",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844260,
      "updated": 1626844260
    },
    {
      "id": "60f7ac64aff09e00003d2fb5",
      "text": "     cy.testid(\"1\").trigger(\"mousemove\", \"center\");",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844260,
      "updated": 1626844260
    },
    {
      "id": "60f7ac64aff09e00003d2fb6",
      "text": "     cy.testid(\"1\").trigger(\"dragstart\", \"center\");",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844260,
      "updated": 1626844260
    },
    {
      "id": "60f7ac64aff09e00003d2fb7",
      "text": "     cy.getGlobal((g) => g.mouseState).should(\"to.eql\", \"\");",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844260,
      "updated": 1626844260
    },
    {
      "id": "60f7ac64aff09e00003d2fb8",
      "text": "     cy.get(\"#canvas\").trigger(\"drop\", 250, 250);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844260,
      "updated": 1626844260
    },
    {
      "id": "60f7ac64aff09e00003d2fb9",
      "text": "   });",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844260,
      "updated": 1626844260
    },
    {
      "id": "60f7ac64aff09e00003d2fba",
      "text": "これは期待通りにfailする",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844260,
      "updated": 1626844309
    },
    {
      "id": "60f7ac95aff09e000039e14d",
      "text": "で、stopPropagationして期待通りに動くことを確認done",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844309,
      "updated": 1626844568
    },
    {
      "id": "60f7ac5faff09e00003d2fb2",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844255,
      "updated": 1626844255
    },
    {
      "id": "60f7adc3aff09e000039e14e",
      "text": "ここまではいい。次は朝気づいた「選択後」の状態について",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844611,
      "updated": 1626844633
    },
    {
      "id": "60f7add9aff09e000039e150",
      "text": "　選択範囲のドラッグで解除されるべきでない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844633,
      "updated": 1626844835
    },
    {
      "id": "60f7aea3aff09e000039e151",
      "text": "　選択範囲外のmousedownでは解除されるべき",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844835,
      "updated": 1626844851
    },
    {
      "id": "60f7c5ffaff09e0000f90006",
      "text": "　あえて図に描くとこう",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626850816,
      "updated": 1626850825
    },
    {
      "id": "60f7aeb3aff09e000039e153",
      "text": "　[https://gyazo.com/651a16356375b1045fad41bffd6b5827]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844851,
      "updated": 1626844853
    },
    {
      "id": "60f7aeb4aff09e000039e154",
      "text": "　うーむ🤔",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844853,
      "updated": 1626844868
    },
    {
      "id": "60f7adc7aff09e000039e14f",
      "text": "　[https://gyazo.com/57c3b688037db501edbe090f08bd39d6]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626844615,
      "updated": 1626850778
    },
    {
      "id": "60f7c5d9aff09e0000f90004",
      "text": "　　Aに解除コードを書くことはできる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626850778,
      "updated": 1626850838
    },
    {
      "id": "60f7c616aff09e0000f90007",
      "text": "　　しかし今後似たようなものが増えた時に書き漏らしそう",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626850838,
      "updated": 1626850854
    },
    {
      "id": "60f7c627aff09e0000f90008",
      "text": "　　全部に自動的に解除コードをつけることはできない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626850855,
      "updated": 1626850872
    },
    {
      "id": "60f7c637aff09e0000f90009",
      "text": "　　　Bで解除してはいけないから",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626850872,
      "updated": 1626850880
    },
    {
      "id": "60f7c65faff09e0000f9000a",
      "text": "　　自然言語でいうなら「選択範囲以外でのmousedownで解除」",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626850911,
      "updated": 1626850966
    },
    {
      "id": "60f7c696aff09e0000f9000b",
      "text": "　　　この「以外」とは何か？",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626850967,
      "updated": 1626850973
    },
    {
      "id": "60f7c69daff09e0000f9000c",
      "text": "　　　　選択範囲にDOM的に包含されてる付箋でのmousedownは？",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626850973,
      "updated": 1626851021
    },
    {
      "id": "60f7c6ccaff09e0000f9000d",
      "text": "　　　　これは「DOMの重ね順序」(おっと、また新しいスコープだ)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626851021,
      "updated": 1626851079
    },
    {
      "id": "60f7c706aff09e0000f9000e",
      "text": "　　　　DOMの重ね順序的に選択範囲は選択された付箋(の大部分)より手前にあるのでイベントをブロックするはず",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626851079,
      "updated": 1626851147
    },
    {
      "id": "60f7c7a4aff09e0000f9000f",
      "text": "　　　　[https://gyazo.com/f77daf0dca10987a865497d17abc7775]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626851236,
      "updated": 1626851238
    },
    {
      "id": "60f7c7a5aff09e0000f90010",
      "text": "　　　　　Cのクリックで付箋にmousedownが発生しない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626851238,
      "updated": 1626851264
    },
    {
      "id": "60f7c7cbaff09e0000f90011",
      "text": "　　　　　Dは選択範囲外クリックだから選択解除して良い",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626851276,
      "updated": 1626851371
    },
    {
      "id": "60f7c82baff09e0000f90012",
      "text": "　　　　待てよ、ということは「選択されたものをdivに追加」ってやる時に別のdivが必要？",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626851371,
      "updated": 1626853032
    },
    {
      "id": "60f7cff2aff09e00003d2fbb",
      "text": "　　　　\tz-indexでいい？",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626853363,
      "updated": 1626853369
    },
    {
      "id": "60f7d028aff09e00009f8875",
      "text": "　　　　いや、違うな、選択範囲を可視化するためのdivを選択範囲をまとめるために使う必要がない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626853417,
      "updated": 1626853445
    },
    {
      "id": "60f7d044aff09e00009f8876",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626853445,
      "updated": 1626854706
    },
    {
      "id": "60f7e32eaff09e00003d2fc2",
      "text": "「選択されてないもの」のopacityを下げることで選択されたものをハイライトすることにした",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626858287,
      "updated": 1626858342
    },
    {
      "id": "60f7d532aff09e00003d2fbc",
      "text": "\t[https://gyazo.com/954963b304cfd7aff577f27a97efc3f2]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626854707,
      "updated": 1626858286
    },
    {
      "id": "60f7d533aff09e00003d2fbd",
      "text": "　これはまだ状態の解除を実装してない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626854707,
      "updated": 1626854793
    },
    {
      "id": "60f7c5d8aff09e0000f90003",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626850777,
      "updated": 1626850777
    },
    {
      "id": "60f7d818aff09e00009f8877",
      "text": "あー、ダメだ、選択範囲の表示をドラッグと選択されたオブジェクトを包むdivが分かれたら「選択範囲の表示」をドラッグしても選択されたオブジェクトが動かないじゃん…",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626855449,
      "updated": 1626855521
    },
    {
      "id": "60f7d9dcaff09e00009f8879",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626855900,
      "updated": 1626855900
    },
    {
      "id": "60f7e328aff09e00003d2fc0",
      "text": "複数個選択してドラッグで移動するところまではできたが「選択範囲の表示」が移動してない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626858281,
      "updated": 1626858281
    },
    {
      "id": "60f7d9dcaff09e00009f887a",
      "text": "\t[https://gyazo.com/91dae056758bbe6355c7754dd1f24c47]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626855901,
      "updated": 1626858283
    },
    {
      "id": "60f7e2d3aff09e00003d2fbe",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626858195,
      "updated": 1626858279
    },
    {
      "id": "60f7e61faff09e00003d2fc3",
      "text": "できた",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626859040,
      "updated": 1626859045
    },
    {
      "id": "60f7e625aff09e00003d2fc5",
      "text": "\t[https://gyazo.com/f8bac0032f9b9fc356ffc5b1c9a95184]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626859045,
      "updated": 1626859050
    },
    {
      "id": "60f7e625aff09e00003d2fc6",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626859045,
      "updated": 1626859045
    },
    {
      "id": "60f7ee09aff09e00003d2fca",
      "text": "テストケースを書いた結果、期待した位置から縦方向に2ピクセルだけズレてることが明らかになった(苦笑",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626861066,
      "updated": 1626861243
    },
    {
      "id": "60f7f637aff09e00009f887b",
      "text": "　top:150pxのdivの(0, 2)をdragstartして、実際に発生するイベントは(150, 150)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626863159,
      "updated": 1626863250
    },
    {
      "id": "60f7e624aff09e00003d2fc4",
      "text": "\tCypress環境でしか再現してなさそう...",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626859045,
      "updated": 1626861091
    },
    {
      "id": "60f7ee0eaff09e00003d2fcb",
      "text": "code:test.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626861071,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fcd",
      "text": "     cy.getGlobal((g) => g.selected_items).should(\"to.eql\", items);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fce",
      "text": "     cy.getGlobal((g) => items.map((id) => g.itemStore[id].position)).should(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fcf",
      "text": "       \"to.eql\",",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fd0",
      "text": "       [",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fd1",
      "text": "         [0, 0],",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fd2",
      "text": "         [0, 200],",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fd3",
      "text": "         [200, 0],",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fd4",
      "text": "         [200, 200],",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fd5",
      "text": "       ]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fd6",
      "text": "     );",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fd7",
      "text": "     cy.get(\"#selection-view\").trigger(\"dragstart\", 0, 2); // misterious 2px",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fd8",
      "text": "     cy.get(\"#canvas\").trigger(\"drop\", 100, 100);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fd9",
      "text": "     cy.getGlobal((g) => items.map((id) => g.itemStore[id].position)).should(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fda",
      "text": "       \"to.eql\",",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fdb",
      "text": "       [",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fdc",
      "text": "         [-50, -50],",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fdd",
      "text": "         [-50, 150],",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fde",
      "text": "         [150, -50],",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fdf",
      "text": "         [150, 150],",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fe0",
      "text": "       ]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fe1",
      "text": "     );",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862717
    },
    {
      "id": "60f7f47daff09e00003d2fe2",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862717,
      "updated": 1626862718
    },
    {
      "id": "60f7f47aaff09e00003d2fcc",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1626862715,
      "updated": 1626862715
    }
  ]
}