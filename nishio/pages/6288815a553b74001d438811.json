{
  "id": "6288815a553b74001d438811",
  "title": "pin-diary-X",
  "created": 1653113180,
  "updated": 1653976265,
  "lines": [
    {
      "id": "6288815a553b74001d438811",
      "text": "pin-diary-X",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653113180,
      "updated": 1653113180
    },
    {
      "id": "6288ec74aff09e0000d7892a",
      "text": "[井戸端]で使われている日記ページ作成システムを自分のプロジェクトにも導入した。",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653140596,
      "updated": 1653140658
    },
    {
      "id": "6288ecb1aff09e0000d7892b",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653140658,
      "updated": 1653140658
    },
    {
      "id": "6288f5f0aff09e0000d7893c",
      "text": "導入メモ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653143024,
      "updated": 1653143028
    },
    {
      "id": "6288ecb2aff09e0000d7892c",
      "text": "　2022-05-21現在の最新のコード",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653140658,
      "updated": 1653143030
    },
    {
      "id": "6288815caff09e0000698af2",
      "text": "　　[/villagepump/pin-diary-6]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653113180,
      "updated": 1653143031
    },
    {
      "id": "6288ecc9aff09e0000d7892d",
      "text": " これはTypeScriptで書かれていることと、複数のファイルに分かれて、サードパーティのライブラリも使っていることから、事前にバンドルする必要がある",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653140681,
      "updated": 1653142098
    },
    {
      "id": "6288ed45aff09e0000d7892f",
      "text": " 　バンドルしたものは例えばこのようになる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653140805,
      "updated": 1653142098
    },
    {
      "id": "62888168aff09e0000698af4",
      "text": " 　　[/takker/pin-diary-6-min]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653113193,
      "updated": 1653142098
    },
    {
      "id": "6288edb6aff09e0000d78930",
      "text": " 　　このスクリプトが「日記ページを追加したいプロジェクトX」から呼び出される仕組み",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653140918,
      "updated": 1653142098
    },
    {
      "id": "6288ee44aff09e0000d78931",
      "text": " 　　　Xのユーザページでインポートして使っている",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653141061,
      "updated": 1653142098
    },
    {
      "id": "6288f245aff09e0000d78937",
      "text": " 　　　([/takker/import#619379b61280f0000031837c]を経由している)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653142085,
      "updated": 1653142098
    },
    {
      "id": "6288ee9aaff09e0000d78932",
      "text": "　日記ページのデザインやタイトルは関数に切り出されているから変えたければこれを変えればいい",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653141146,
      "updated": 1653142163
    },
    {
      "id": "6288823eaff09e0000698af5",
      "text": "　　[/villagepump/pin-diary-6/template]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653113407,
      "updated": 1653142166
    },
    {
      "id": "6288f60daff09e0000d7893d",
      "text": "　必要なファイルはすべてこのページに転記した",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653143053,
      "updated": 1653143068
    },
    {
      "id": "6288f677aff09e0000d7893f",
      "text": "　　自分向けに変更するscript.tsとtemplate.ts以外は井戸端に置いたままプロジェクトを跨いだURL importをする手もある",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653143160,
      "updated": 1653143359
    },
    {
      "id": "6288f73faff09e0000d78941",
      "text": "　　全体像がわからないまま使うのが気持ち悪かったので全部集めただけ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653143359,
      "updated": 1653143362
    },
    {
      "id": "6288f29baff09e0000d78938",
      "text": "　バンドルにはこれを使う",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653142171,
      "updated": 1653142176
    },
    {
      "id": "628882a9aff09e0000698af6",
      "text": "　　[/villagepump/scrapbox-bundler]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653113513,
      "updated": 1653142179
    },
    {
      "id": "628884d0aff09e0000698af8",
      "text": "　　`deno bundle <url> | esbuild --minify`をしているだけなので手元に開発環境があるならそれで良い",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114065,
      "updated": 1653142286
    },
    {
      "id": "6288f383aff09e0000d78939",
      "text": "　　このビルド結果がCDNに入って明示的リフレッシュしない限り10年キャッシュされるとかではないので、今はできたスクリプトを手作業でScrapboxに貼ってる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653142403,
      "updated": 1653142802
    },
    {
      "id": "6288f513aff09e0000d7893a",
      "text": "　　　ちょっとめんどくさいけど、この作業を今後たくさんやる予定はないので自動化しようという気持ちにはなってない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653142804,
      "updated": 1653142894
    },
    {
      "id": "62888562aff09e0000698c1c",
      "text": "　　このURLにアクセスするとビルドが走る",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114211,
      "updated": 1653143397
    },
    {
      "id": "6288f756aff09e0000d78943",
      "text": "　　　https://scrapbox-bundler.vercel.app/?url=https://scrapbox.io/api/code/nishio/pin-diary-X/script.ts&bundle&minify&run&output=newtab&reload",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653143383,
      "updated": 1653143383
    },
    {
      "id": "6288f81baff09e0000d78946",
      "text": "　　　実際にやってみると一部のファイルがないとエラーが出て、pin-diary-5からいくつかの関数をインポートすることが必要だった",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653143579,
      "updated": 1653143627
    },
    {
      "id": "628885b7aff09e0000698c1d",
      "text": "　　出来上がったものをこのページの末尾にmin.jsという名前で置いた、これを自分のUserScriptから呼び出して使う",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114295,
      "updated": 1653143446
    },
    {
      "id": "6288f796aff09e0000d78944",
      "text": "　[/villagepump/なぜかpin-diaryでunpinされない]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653143446,
      "updated": 1653283478
    },
    {
      "id": "628b1a96aff09e0000fadac6",
      "text": "　 タイトルのフォーマットを変えた場合、タイトルのフォーマットを判定する正規表現も合わせて変える必要がある",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653283478,
      "updated": 1653283490
    },
    {
      "id": "6295acbcaff09e00008a0125",
      "text": "　deps.tsの意味",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653976252,
      "updated": 1653976264
    },
    {
      "id": "628b1aa2aff09e0000fadac7",
      "text": "\t\t[/deno-ja/deps.tsでモジュールを管理する#5fb4f9c21a00a2000055ba]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653283490,
      "updated": 1653976265
    },
    {
      "id": "6294587faff09e00003fc678",
      "text": "　2022-05-30",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653889152,
      "updated": 1653889167
    },
    {
      "id": "62945892aff09e00007aa119",
      "text": "　　未踏ジュニアのScrapboxに作業室テンプレートでページを作成するようにした",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653889170,
      "updated": 1653889195
    },
    {
      "id": "62943fe4aff09e00004c1060",
      "text": "　\tその後「ピン留めしないようにしたい」という本体部分に手を加えるニーズが出てきたのでこのページではなく[/mitoujr-script/times-dev]に移した",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653882852,
      "updated": 1653976166
    },
    {
      "id": "62943fe4aff09e00004c1061",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653882852,
      "updated": 1653882852
    },
    {
      "id": "628884e3aff09e0000698b0b",
      "text": "code:script.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114098
    },
    {
      "id": "628884e3aff09e0000698b0c",
      "text": " import { launch } from \"./mod.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653116276
    },
    {
      "id": "628884e3aff09e0000698b0d",
      "text": " import {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114098
    },
    {
      "id": "628884e3aff09e0000698b0e",
      "text": "   makeDiary, filter,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114098
    },
    {
      "id": "628884e3aff09e0000698b0f",
      "text": " } from \"./template.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114231
    },
    {
      "id": "628884e3aff09e0000698b10",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114098
    },
    {
      "id": "628884e3aff09e0000698b11",
      "text": " launch(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114098
    },
    {
      "id": "628884e3aff09e0000698b12",
      "text": "   \"nishio\",",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114237
    },
    {
      "id": "628884e3aff09e0000698b13",
      "text": "   {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114098
    },
    {
      "id": "628884e3aff09e0000698b14",
      "text": "     makeDiary,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114098
    },
    {
      "id": "628884e3aff09e0000698b15",
      "text": "     filter,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114098
    },
    {
      "id": "628884e3aff09e0000698b16",
      "text": "   },",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114098
    },
    {
      "id": "628884e3aff09e0000698b17",
      "text": " );",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114098
    },
    {
      "id": "628884e3aff09e0000698b18",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114101
    },
    {
      "id": "6288f7e2aff09e0000565a75",
      "text": "code:template.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653143523,
      "updated": 1653143523
    },
    {
      "id": "6288f7e3aff09e0000565a76",
      "text": " import {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653143523,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f75fc",
      "text": "   getDay,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f75fd",
      "text": "   getWeek,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f75fe",
      "text": "   addDays,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f75ff",
      "text": "   subDays,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7600",
      "text": "   subYears,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7601",
      "text": "   getYear,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7602",
      "text": "   lightFormat,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7603",
      "text": "   getDayOfYear,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7604",
      "text": "   getDaysInYear,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7605",
      "text": " } from \"./template_deps.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7606",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7607",
      "text": " const titleFormat = \"日記yyyy-MM-dd\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7608",
      "text": " const titleRegExp = /^日記\\d{4}-\\d{2}-\\d{2}$/;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7609",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f760a",
      "text": " export function makeDiary(date: Date): {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f760b",
      "text": "   title: string;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f760c",
      "text": "   header: string[];",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f760d",
      "text": "   footer: string[];",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f760e",
      "text": " } {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f760f",
      "text": "   return {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7610",
      "text": "     title: toTitle(date),",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7611",
      "text": "     header: [],",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7612",
      "text": "     footer: [",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7613",
      "text": "       `[${lightFormat(subDays(date, 1), titleFormat)}]←${lightFormat(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7614",
      "text": "         date,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7615",
      "text": "         titleFormat",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7616",
      "text": "       )}→[${lightFormat(addDays(date, 1), titleFormat)}]`,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7617",
      "text": "       `100日前 [${lightFormat(subDays(date, 100), titleFormat)}]`,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7618",
      "text": "       `1年前 [${lightFormat(subYears(date, 1), titleFormat)}]`,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7619",
      "text": "     ],",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f761a",
      "text": "   };",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f761b",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f761c",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f761d",
      "text": " function youbiLine(date: Date): string {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f761e",
      "text": "   const day = getDay(date);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f761f",
      "text": "   return [...\"日月火水木金土\"]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7620",
      "text": "     .map((char, i) => (i === day ? `[[${char}]]` : char))",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7621",
      "text": "     .join(\"\");",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7622",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7623",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7624",
      "text": " export function filter(title: string, today: Date): boolean {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7625",
      "text": "   if (!titleRegExp.test(title)) return true;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7626",
      "text": "   return toTitle(today) === title;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7627",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7628",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f7629",
      "text": " function toTitle(date: Date): string {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f762a",
      "text": "   return lightFormat(date, titleFormat);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "628b0b40aff09e00007f762b",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279553,
      "updated": 1653279553
    },
    {
      "id": "62943c71aff09e0000e115b9",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653881969,
      "updated": 1653881969
    },
    {
      "id": "62888eb7aff09e00009abd9e",
      "text": "code:template_deps.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116600,
      "updated": 1653116605
    },
    {
      "id": "62888ebdaff09e00009abd9f",
      "text": " // 一年の経過率を計算するのに必要",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116605,
      "updated": 1653116615
    },
    {
      "id": "62888ec7aff09e00009abda0",
      "text": "  export { default as getDaysInYear } from \"https://deno.land/x/date_fns@v2.22.1/getDaysInYear/index.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116615,
      "updated": 1653116615
    },
    {
      "id": "62888ec7aff09e00009abda1",
      "text": "  export { default as getDayOfYear } from \"https://deno.land/x/date_fns@v2.22.1/getDayOfYear/index.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116615,
      "updated": 1653116615
    },
    {
      "id": "62888ec7aff09e00009abda2",
      "text": "  // 日付計算に使う",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116615,
      "updated": 1653116615
    },
    {
      "id": "62888ec7aff09e00009abda3",
      "text": "  export { default as addDays } from \"https://deno.land/x/date_fns@v2.22.1/addDays/index.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116615,
      "updated": 1653116615
    },
    {
      "id": "62888ec7aff09e00009abda4",
      "text": "  export { default as subDays } from \"https://deno.land/x/date_fns@v2.22.1/subDays/index.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116615,
      "updated": 1653116615
    },
    {
      "id": "62888ec7aff09e00009abda5",
      "text": "  export { default as getWeek } from \"https://deno.land/x/date_fns@v2.22.1/getWeek/index.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116615,
      "updated": 1653116615
    },
    {
      "id": "62888ec7aff09e00009abda6",
      "text": "  export { default as subYears } from \"https://deno.land/x/date_fns@v2.22.1/subYears/index.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116615,
      "updated": 1653116615
    },
    {
      "id": "62888ec7aff09e00009abda7",
      "text": "  export { default as getDay } from \"https://deno.land/x/date_fns@v2.22.1/getDay/index.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116615,
      "updated": 1653116615
    },
    {
      "id": "62888ec7aff09e00009abda8",
      "text": "  export { default as getYear } from \"https://deno.land/x/date_fns@v2.22.1/getYear/index.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116615,
      "updated": 1653116615
    },
    {
      "id": "62888ec7aff09e00009abda9",
      "text": "  // 文字列変換に使う",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116615,
      "updated": 1653116615
    },
    {
      "id": "62888ec7aff09e00009abdaa",
      "text": "  export { default as lightFormat } from \"https://deno.land/x/date_fns@v2.22.1/lightFormat/index.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116615,
      "updated": 1653116615
    },
    {
      "id": "6288850baff09e0000698be4",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114124,
      "updated": 1653143520
    },
    {
      "id": "628884e3aff09e0000698b30",
      "text": "code:mod.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b31",
      "text": " /// <reference no-default-lib=\"true\"/>",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b32",
      "text": " /// <reference lib=\"esnext\"/>",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b33",
      "text": " /// <reference lib=\"dom\"/>",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b34",
      "text": " import {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b35",
      "text": "   pin,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b36",
      "text": "   unpin,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b37",
      "text": "   patch,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b38",
      "text": "   useStatusBar,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b39",
      "text": "   sleep,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b3a",
      "text": "   makeSocket,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b3b",
      "text": "   disconnect,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b3c",
      "text": "   format,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b3d",
      "text": " } from \"./deps.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b3e",
      "text": " import { listPinnedPages } from \"./list.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b3f",
      "text": " import type { Scrapbox, Socket } from \"./deps.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b40",
      "text": " declare const scrapbox: Scrapbox;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b41",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b42",
      "text": " export interface DiaryInit {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b43",
      "text": "   makeDiary: (date: Date) => {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b44",
      "text": "     title: string;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b45",
      "text": "     header: string[];",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b46",
      "text": "     footer: string[];",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b47",
      "text": "   },",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b48",
      "text": "   filter: (title: string, today: Date) => boolean;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b49",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b4a",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b4b",
      "text": " // initialize",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b4c",
      "text": " export function launch(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b4d",
      "text": "   project: string,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b4e",
      "text": "   init: DiaryInit & { interval?: number },",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b4f",
      "text": " ) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b50",
      "text": "   const interval = init.interval ?? 24 * 3600 * 1000;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b51",
      "text": "   ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b52",
      "text": "   const handleChange = () =>",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b53",
      "text": "     scrapbox.Project.name === project ?",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b54",
      "text": "       startObserve(project, interval, init) :",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b55",
      "text": "       endObserve();",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b56",
      "text": "   handleChange();",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b57",
      "text": "   scrapbox.addListener(\"project:changed\", handleChange);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b58",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b59",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b5a",
      "text": " let updateTimer: number | undefined;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b5b",
      "text": " async function startObserve(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b5c",
      "text": "   project: string,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b5d",
      "text": "   interval: number,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b5e",
      "text": "   init: DiaryInit,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b5f",
      "text": " ) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b60",
      "text": "   endObserve();",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b61",
      "text": "   await pinDiary(project, new Date(), init);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b62",
      "text": "   updateTimer = setInterval(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b63",
      "text": "     () => pinDiary(project, new Date(), init),",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b64",
      "text": "     interval,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b65",
      "text": "   );",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b66",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b67",
      "text": " function endObserve() {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b68",
      "text": "   clearInterval(updateTimer);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b69",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b6a",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b6d",
      "text": " export async function pinDiary(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b6e",
      "text": "   project: string,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b6f",
      "text": "   date: Date,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b70",
      "text": "   { makeDiary, filter, }: DiaryInit,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b71",
      "text": " ): Promise<void> {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b72",
      "text": "   const { render, dispose } = useStatusBar();",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b73",
      "text": "   let socket: Socket | undefined;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b74",
      "text": "   try {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b75",
      "text": "     // 今日以外の日付ページを外す",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b76",
      "text": "     render(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b77",
      "text": "       { type: \"spinner\" },",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b78",
      "text": "       { type: \"text\", text: `unpin other diary pages...`},",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b79",
      "text": "     );",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b7a",
      "text": "     socket = await makeSocket();",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b7b",
      "text": "     for await (const { title } of listPinnedPages(project)) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b7c",
      "text": "       if (filter(title, date)) continue;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b7d",
      "text": "       await unpin(project, title, { socket });",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b7e",
      "text": "     }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b7f",
      "text": "     ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b80",
      "text": "     // 今日の日付ページをピン留めする",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b81",
      "text": "     const { title, header, footer } = makeDiary(date);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b82",
      "text": "     render(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b83",
      "text": "       { type: \"spinner\" },",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b84",
      "text": "       { type: \"text\", text: `pin \"/${project}/${title}\"...`},",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b85",
      "text": "     );",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b86",
      "text": "     await pin(project, title, { socket, create: true });",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b87",
      "text": "     ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b88",
      "text": "     // 今日の日付ページにtemplateを挿入する",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b89",
      "text": "     render(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b8a",
      "text": "       { type: \"spinner\" },",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b8b",
      "text": "       { type: \"text\", text: `format \"/${project}/${title}\"...`},",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b8c",
      "text": "     );",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b8d",
      "text": "     await patch(project, title, (lines) => [",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b8e",
      "text": "       lines[0].text,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b8f",
      "text": "       ...format(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b90",
      "text": "         lines.slice(1).map(line => line.text),",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b91",
      "text": "         header,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b92",
      "text": "         footer,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b93",
      "text": "       ),",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b94",
      "text": "     ], { socket });",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b95",
      "text": "     ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b96",
      "text": "     render(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b97",
      "text": "       { type: \"check-circle\" },",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b98",
      "text": "       { type: \"text\", text: `Pinned \"/${project}/${title}\".`},",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b99",
      "text": "     );",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b9a",
      "text": "   } catch(e: unknown) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b9b",
      "text": "     render(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b9c",
      "text": "       { type: \"exclamation-triangle\" },",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b9d",
      "text": "       { type: \"text\", text: e instanceof Error ?",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b9e",
      "text": "         `${e.name} ${e.message}` :",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698b9f",
      "text": "         `Unknown error! (see developper console)`,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698ba0",
      "text": "       },",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698ba1",
      "text": "     );",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698ba2",
      "text": "     console.error(e);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698ba3",
      "text": "   } finally {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698ba4",
      "text": "     if (socket) await disconnect(socket);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698ba5",
      "text": "     await sleep(1000);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698ba6",
      "text": "     dispose();",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698ba7",
      "text": "   }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698ba8",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698ba9",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698baa",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bab",
      "text": "code:list.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bac",
      "text": " import { listPages, PageSummary } from \"./deps.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bad",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bae",
      "text": " /** 全てのピン留めされたページを取得する */",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698baf",
      "text": " export async function* listPinnedPages(project: string, skip = 0): AsyncGenerator<PageSummary> {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bb0",
      "text": "   const { count, pages } = await ensureList(project, skip);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bb1",
      "text": "   for (const page of pages) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bb2",
      "text": "     if (page.pin === 0) continue;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bb3",
      "text": "     yield page;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bb4",
      "text": "   }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bb5",
      "text": "   // pinしたページこれ以上ないときは終了",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bb6",
      "text": "   if ((pages.at(-1)?.pin ?? 0) === 0) return;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bb7",
      "text": "   yield* listPinnedPages(project, skip + 1000);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bb8",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bb9",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bba",
      "text": " async function ensureList(project: string, skip: number) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bbb",
      "text": "   const result = await listPages(project, {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bbc",
      "text": "     limit: 1000,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bbd",
      "text": "     skip,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bbe",
      "text": "   });",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bbf",
      "text": "   // login errorなどは全部例外として扱う",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bc0",
      "text": "   if (!result.ok) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bc1",
      "text": "     const error = new Error();",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bc2",
      "text": "     error.name = result.value.name;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bc3",
      "text": "     error.message = result.value.message;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bc4",
      "text": "     throw error;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bc5",
      "text": "   }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bc6",
      "text": "   ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bc7",
      "text": "   return result.value;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bc8",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bc9",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bca",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bcb",
      "text": "code:deps.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bcc",
      "text": " export { patchTemplate as format } from \"./format.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114372
    },
    {
      "id": "628884e3aff09e0000698bcd",
      "text": " export {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bce",
      "text": "   pin,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bcf",
      "text": "   unpin,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bd0",
      "text": "   patch,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bd1",
      "text": "   useStatusBar,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bd2",
      "text": "   makeSocket,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bd3",
      "text": "   disconnect,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bd4",
      "text": "   listPages,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bd5",
      "text": " } from \"https://raw.githubusercontent.com/takker99/scrapbox-userscript-std/0.10.3/mod.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bd6",
      "text": " export type {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bd7",
      "text": "   Socket,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bd8",
      "text": " } from \"https://raw.githubusercontent.com/takker99/scrapbox-userscript-std/0.10.3/mod.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bd9",
      "text": " export {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bda",
      "text": "   sleep,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bdb",
      "text": " } from \"https://raw.githubusercontent.com/takker99/scrapbox-userscript-std/0.10.3/sleep.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bdc",
      "text": " export type {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bdd",
      "text": "   Scrapbox,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bde",
      "text": "   PageSummary,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698bdf",
      "text": " } from \"https://raw.githubusercontent.com/scrapbox-jp/types/0.0.8/mod.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698be0",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "628884e3aff09e0000698be1",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114083,
      "updated": 1653114083
    },
    {
      "id": "6288862daff09e0000698c20",
      "text": "https://scrapbox.io/api/code/villagepump/pin-diary-5/format.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114413,
      "updated": 1653114414
    },
    {
      "id": "628885eaaff09e0000698c1e",
      "text": "code:format.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114348,
      "updated": 1653114352
    },
    {
      "id": "628885f0aff09e0000698c1f",
      "text": " import { patchLines, findSplitIndex } from \"./util.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114352,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c21",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c22",
      "text": " // linesにタイトルを入れないように",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c23",
      "text": " export function patchTemplate(lines: string[], headers: string[], footers: string[]): string[] {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c24",
      "text": "   // headerとfooterに相当する行を補う",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c25",
      "text": "   const bodies = patchLines(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c26",
      "text": "     patchLines(lines, headers).reverse(),",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c27",
      "text": "     [...footers].reverse(),",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c28",
      "text": "   ).reverse();",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c29",
      "text": "   ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c2a",
      "text": "   // headerとfooterの間に余裕をもたせる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c2b",
      "text": "   const headerStart = findSplitIndex(bodies, headers);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c2c",
      "text": "   const footerStart = bodies.length - 1 - findSplitIndex(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c2d",
      "text": "     [...bodies].reverse(),",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c2e",
      "text": "     [...footers].reverse(),",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c2f",
      "text": "   );",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c30",
      "text": "   return [",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c31",
      "text": "     ...bodies.slice(0, headerStart + 1),",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c32",
      "text": "     \"\",",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c33",
      "text": "     ...bodies.slice(headerStart + 1, footerStart).join(\"\\n\").trim().split(\"\\n\"),",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c34",
      "text": "     \"\",",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c35",
      "text": "     ...bodies.slice(footerStart),",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c36",
      "text": "   ];",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "6288863eaff09e0000698c37",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114431,
      "updated": 1653114431
    },
    {
      "id": "628884d4aff09e0000698b04",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114068,
      "updated": 1653114068
    },
    {
      "id": "6288869baff09e0000698c3b",
      "text": "https://scrapbox.io/api/code/villagepump/pin-diary-5/util.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114523,
      "updated": 1653114523
    },
    {
      "id": "62888681aff09e0000698c38",
      "text": "code:util.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114498,
      "updated": 1653114501
    },
    {
      "id": "62888685aff09e0000698c3a",
      "text": " export function patchLines(lines: string[], appends: string[]) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114501,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c3c",
      "text": "   let index = 0;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c3d",
      "text": "   const result = [] as string[];",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c3e",
      "text": "   for (let i = 0; i < appends.length; i++) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c3f",
      "text": "     const pos = lines.findIndex((line, j) => j >= index && line.trim() === appends[i].trim());",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c40",
      "text": "     if (pos < 0) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c41",
      "text": "       result.push(appends[i]);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c42",
      "text": "       continue;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c43",
      "text": "     }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c44",
      "text": "     result.push(...lines.slice(index, pos + 1));",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c45",
      "text": "     index = pos + 1;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c46",
      "text": "   }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c47",
      "text": "   result.push(...lines.slice(index));",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c48",
      "text": "   return result;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c49",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c4a",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c4b",
      "text": " export function findSplitIndex(lines: string[], query: string[]) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c4c",
      "text": "   let index = -1;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c4d",
      "text": "   for (const text of query) {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c4e",
      "text": "     const pos = lines.findIndex((line, j) => j > index && line.trim() === text.trim());",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c4f",
      "text": "     if (pos < 0) return -1;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c50",
      "text": "     index = pos;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c51",
      "text": "   }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c52",
      "text": "   return index;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "628886a8aff09e0000698c53",
      "text": " }",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114537,
      "updated": 1653114537
    },
    {
      "id": "62888682aff09e0000698c39",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653114499,
      "updated": 1653114499
    },
    {
      "id": "62888d90aff09e0000698c5f",
      "text": "code:min.js",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116305,
      "updated": 1653116310
    },
    {
      "id": "62888d95aff09e0000698c61",
      "text": " function X(e,t){let r=0,n=[];for(let o=0;o<t.length;o++){let s=e.findIndex((a,i)=>i>=r&&a.trim()===t[o].trim());if(s<0){n.push(t[o]);continue}n.push(...e.slice(r,s+1)),r=s+1}return n.push(...e.slice(r)),n}function G(e,t){let r=-1;for(let n of t){let o=e.findIndex((s,a)=>a>r&&s.trim()===n.trim());if(o<0)return-1;r=o}return r}function V(e,t,r){let n=X(X(e,t).reverse(),[...r].reverse()).reverse(),o=G(n,t),s=n.length-1-G([...n].reverse(),[...r].reverse());return[...n.slice(0,o+1),\"\",...n.slice(o+1,s).join(`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116310,
      "updated": 1653279591
    },
    {
      "id": "628b0b66aff09e00007f762d",
      "text": " `).trim().split(`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279591,
      "updated": 1653279591
    },
    {
      "id": "628b0b66aff09e00007f762e",
      "text": " `),\"\",...n.slice(s)]}async function J(e){let t=\"https://scrapbox.io/api/users/me\",r=await fetch(t,e?.sid?{headers:{Cookie:I(e.sid)}}:void 0);if(!r.ok)throw L(\"UnexpectedError\",`Unexpected error has occuerd when fetching \"${t}\"`);return await r.json()}var I=e=>`connect.sid=${e}`;function Ye(e){return e!=null}function qe(e){return Ye(e)?(e.name===void 0||typeof e.name==\"string\")&&typeof e.message==\"string\":!1}function S(e){try{let t=typeof e==\"string\"?JSON.parse(e):e;return qe(t)?t:!1}catch(t){if(t instanceof SyntaxError)return!1;throw t}}function L(e,t){let r=new Error;return r.name=e,r.message=t,r}var U=e=>e.replaceAll(\" \",\"_\").toLowerCase();var Z=e=>[...e].map((t,r)=>t===\" \"?\"_\":!Be.includes(t)||r===e.length-1&&Ke.includes(t)?encodeURIComponent(t):t).join(\"\"),Be='@$&+=:;\",',Ke=':;\",';async function le(e,t,r){let n=`https://scrapbox.io/api/pages/${e}/${Z(t)}?followRename=${r?.followRename??!0}`,o=await fetch(n,r?.sid?{headers:{Cookie:I(r.sid)}}:void 0);if(!o.ok){let a=S(await o.text());if(!a)throw L(\"UnexpectedError\",`Unexpected error has occuerd when fetching \"${n}\"`);return{ok:!1,value:a}}let s=await o.json();return{ok:!0,value:s}}async function ee(e,t){let{sort:r,limit:n,skip:o}=t??{},s=new URLSearchParams;r!==void 0&&s.append(\"sort\",r),n!==void 0&&s.append(\"limit\",`${n}`),o!==void 0&&s.append(\"skip\",`${o}`);let a=`https://scrapbox.io/api/pages/${e}?${s.toString()}`,i=await fetch(a,t?.sid?{headers:{Cookie:I(t.sid)}}:void 0);if(!i.ok){let d=S(await i.text());if(!d)throw L(\"UnexpectedError\",`Unexpected error has occuerd when fetching \"${a}\"`);return{ok:!1,value:d}}let c=await i.json();return{ok:!0,value:c}}async function me(e,t){let r=`https://scrapbox.io/api/projects/${e}`,n=await fetch(r,t?.sid?{headers:{Cookie:I(t.sid)}}:void 0);if(!n.ok){let s=S(await n.json());if(!s)throw L(\"UnexpectedError\",`Unexpected error has occuerd when fetching \"${r}\"`);return{ok:!1,value:s}}let o=await n.json();return{ok:!0,value:o}}var fe=(e,t)=>{if(!(e instanceof HTMLDivElement))throw new TypeError(`\"${t}\" must be HTMLDivElememt but actual is \"${e}\"`)};var ge=()=>Qe(document.getElementsByClassName(\"status-bar\")?.[0],\"div.status-bar\"),Qe=(e,t)=>{if(!!e)return fe(e,t),e};var F=e=>new Promise(t=>setTimeout(()=>t(),e));function te(){let e=ge();if(!e)throw new Error(\"div.status-bar can't be found\");let t=document.createElement(\"div\");return e.append(t),{render:(...r)=>{t.textContent=\"\";let n=ye(...r);n&&t.append(n)},dispose:()=>t.remove()}}function ye(...e){let t=e.flatMap(n=>{switch(n.type){case\"spinner\":return[Ze()];case\"check-circle\":return[et()];case\"exclamation-triangle\":return[tt()];case\"text\":return[q(n.text)];case\"group\":{let o=ye(...n.items);return o?[o]:[]}}});if(t.length===0)return;if(t.length===1)return t[0];let r=document.createElement(\"span\");return r.classList.add(\"item-group\"),r.append(...t),r}function q(e){let t=document.createElement(\"span\");return t.classList.add(\"item\"),t.append(e),t}function Ze(){let e=document.createElement(\"i\");return e.classList.add(\"fa\",\"fa-spinner\"),q(e)}function et(){let e=document.createElement(\"i\");return e.classList.add(\"kamon\",\"kamon-check-circle\"),q(e)}function tt(){let e=document.createElement(\"i\");return e.classList.add(\"fas\",\"fa-exclamation-triangle\"),q(e)}var rt=\"4.2.0\";async function D(){let t=(await nt())(\"https://scrapbox.io\",{reconnectionDelay:5e3,transports:[\"websocket\"]});return await new Promise((r,n)=>{let o=s=>n(s);t.once(\"connect\",()=>{t.off(\"disconnect\",o),r()}),t.once(\"disconnect\",o)}),t}function nt(){let e=`https://cdnjs.cloudflare.com/ajax/libs/socket.io/${rt}/socket.io.min.js`;if(document.querySelector(`script[src=\"${e}\"]`))return Promise.resolve(window.io);let t=document.createElement(\"script\");return t.src=e,new Promise((r,n)=>{t.onload=()=>r(window.io),t.onerror=o=>n(o),document.head.append(t)})}function N(e,t=9e4){function r(o,s){let a;return new Promise((i,c)=>{let d=u=>{clearTimeout(a),c(new Error(u))};e.emit(o,s,u=>{clearTimeout(a),e.off(\"disconnect\",d),u.error&&c(new Error(JSON.stringify(u.error))),\"data\"in u?i(u?.data):i(void 0)}),a=setTimeout(()=>{e.off(\"disconnect\",d),c(new Error(`Timeout: exceeded ${t}ms`))},t),e.once(\"disconnect\",d)})}async function*n(...o){let s,a=()=>new Promise(c=>s=c),i=c=>{s?.(c)};for(let c of o)e.on(c,i);try{for(;;)yield await a()}finally{for(let c of o)e.off(c,i)}}return{request:r,response:n}}function re(){return D()}async function P(e){if(e.connected)return;let t=new Promise(r=>e.once(\"connect\",()=>r()));e.connect(),await t}async function v(e){if(e.disconnected)return;let t=new Promise(r=>{let n=o=>{o===\"io client disconnect\"&&(r(),e.off(\"disconnect\",n))};e.on(\"disconnect\",n)});e.disconnect(),await t}var B;async function _(){if(B!==void 0)return B;let e=await J();if(e.isGuest)throw new Error(\"this script can only be executed by Logged in users\");return B=e.id,B}var be=new Map;async function A(e){let t=be.get(e);if(t!==void 0)return t;let r=await me(e);if(!r.ok){let{name:o,message:s}=r.value;throw new Error(`${o} ${s}`)}let{id:n}=r.value;return be.set(e,n),n}function we(e){return e.padStart(8,\"0\")}function ke(e){let t=Math.floor(new Date().getTime()/1e3).toString(16),r=Math.floor(16777214*Math.random()).toString(16);return`${we(t).slice(-8)}${e.slice(-6)}0000${we(r)}`}function Ee(e,t){let r=e.length>t.length,n=r?t:e,o=r?e:t,s=n.length+1,a=n.length+o.length+3,i=new Array(a);i.fill(-1);let c=[];function d(l,w,O){let E=Math.max(w,O),Y=E-l;for(;Y<n.length&&E<o.length&&n[Y]===o[E];)++Y,++E;return i[l+s]=c.length,c.push([{x:Y,y:E},i[l+(w>O?-1:1)+s]]),E}let u=new Array(a);u.fill(-1);let y=-1,f=o.length-n.length;do{++y;for(let l=-y;l<=f-1;++l)u[l+s]=d(l,u[l-1+s]+1,u[l+1+s]);for(let l=f+y;l>=f+1;--l)u[l+s]=d(l,u[l-1+s]+1,u[l+1+s]);u[f+s]=d(f,u[f-1+s]+1,u[f+1+s])}while(u[f+s]!==o.length);let k=[],b=i[f+s];for(;b!==-1;)k.push(c[b][0]),b=c[b][1];return{from:e,to:t,editDistance:f+y*2,buildSES:function*(){let l=0,w=0;for(let{x:O,y:E}of ot(k))for(;l<O||w<E;)E-O>w-l?(yield{value:o[w],type:r?\"deleted\":\"added\"},++w):E-O<w-l?(yield{value:n[l],type:r?\"added\":\"deleted\"},++l):(yield{value:n[l],type:\"common\"},++l,++w)}}}function*De(e){let t=[],r=[];function*n(){if(t.length>r.length){for(let o=0;o<r.length;o++)yield ve(t[o],r[o]);for(let o=r.length;o<t.length;o++)yield t[o]}else{for(let o=0;o<t.length;o++)yield ve(t[o],r[o]);for(let o=t.length;o<r.length;o++)yield r[o]}t=[],r=[]}for(let o of e)switch(o.type){case\"added\":t.push(o);break;case\"deleted\":r.push(o);break;case\"common\":yield*n(),yield o;break}yield*n()}function ve(e,t){return{value:e.value,oldValue:t.value,type:\"replaced\"}}function*ot(e){for(let t=e.length-1;t>=0;t--)yield e[t]}function*Te(e,t,{userId:r}){let{buildSES:n}=Ee(e.map(({text:a})=>a),t),o=0,s=e[0].id;for(let a of De(n())){switch(a.type){case\"added\":yield{_insert:s,lines:{id:ke(r),text:a.value}};continue;case\"deleted\":yield{_delete:s,lines:-1};break;case\"replaced\":yield{_update:s,lines:{text:a.value}};break}o++,s=e[o]?.id??\"_end\"}}var st=e=>({type:\"title\",text:e.rows[0].text}),it=e=>{let{rows:[t,...r]}=e,{indent:n=0,text:o=\"\"}=t??{},s=o.replace(/^\\s*code:/,\"\");return{indent:n,type:\"codeBlock\",fileName:s,content:r.map(a=>a.text.substring(n+1)).join(`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279591,
      "updated": 1653279591
    },
    {
      "id": "628b0b66aff09e00007f762f",
      "text": " `)}},x=(e,{parseOnNested:t,parseOnQuoted:r,patterns:n})=>(o,s,a)=>{var i,c,d,u,y,f;if(!t&&s.nested)return(i=a?.())!==null&&i!==void 0?i:[];if(!r&&s.quoted)return(c=a?.())!==null&&c!==void 0?c:[];for(let k of n){let b=k.exec(o);if(b===null)continue;let l=o.substring(0,b.index),w=o.substring(b.index+((u=(d=b[0])===null||d===void 0?void 0:d.length)!==null&&u!==void 0?u:0)),O=e((y=b[0])!==null&&y!==void 0?y:\"\",s);return[...H(l,s),...O,...H(w,s)]}return(f=a?.())!==null&&f!==void 0?f:[]},h=e=>[{type:\"plain\",raw:e,text:e}],at=x(h,{parseOnNested:!0,parseOnQuoted:!0,patterns:[/^()(.*)()$/]}),ct=/^>.*$/,ut=(e,t)=>t.context===\"table\"?h(e,t):[{type:\"quote\",raw:e,nodes:H(e.substring(1),{...t,quoted:!0})}],dt=x(ut,{parseOnNested:!1,parseOnQuoted:!1,patterns:[ct]}),pt=/^\\? .+$/,lt=(e,t)=>t.context===\"table\"?h(e,t):[{type:\"helpfeel\",raw:e,text:e.substring(2)}],mt=x(lt,{parseOnNested:!1,parseOnQuoted:!1,patterns:[pt]}),ft=/\\[\\[https?:\\/\\/[^\\s\\]]+\\.(?:png|jpe?g|gif|svg)\\]\\]/i,gt=/\\[\\[https?:\\/\\/(?:[0-9a-z-]+\\.)?gyazo\\.com\\/[0-9a-f]{32}\\]\\]/,xt=(e,t)=>{if(t.context===\"table\")return h(e,t);let r=e.substring(2,e.length-2),n=/^https?:\\/\\/([0-9a-z-]\\.)?gyazo\\.com\\/[0-9a-f]{32}$/.test(r);return[{type:\"strongImage\",raw:e,src:n?`${r}/thumb/1000`:r}]},ht=x(xt,{parseOnNested:!1,parseOnQuoted:!0,patterns:[ft,gt]}),yt=/\\[[^[\\]]*\\.icon(?:\\*[1-9]\\d*)?\\]/;function Ie(e){return(t,r)=>{if(e===\"strongIcon\"&&r.context===\"table\")return h(t,r);let n=e===\"icon\"?t.substring(1,t.length-1):t.substring(2,t.length-2),o=n.lastIndexOf(\".icon\"),s=n.substring(0,o),a=s.startsWith(\"/\")?\"root\":\"relative\",i=n.substring(o+5,n.length),c=i.startsWith(\"*\")?parseInt(i.substring(1),10):1;return new Array(c).fill({}).map(()=>({path:s,pathType:a,type:e,raw:t}))}}var bt=Ie(\"icon\"),wt=x(bt,{parseOnNested:!1,parseOnQuoted:!0,patterns:[yt]}),kt=/\\[\\[[^[\\]]*\\.icon(?:\\*\\d+)?\\]\\]/,Et=Ie(\"strongIcon\"),Dt=x(Et,{parseOnNested:!1,parseOnQuoted:!0,patterns:[kt]}),vt=/\\[\\[(?:[^[]|\\[[^[]).*?\\]*\\]\\]/,Tt=(e,t)=>t.context===\"table\"?h(e,t):[{type:\"strong\",raw:e,nodes:H(e.substring(2,e.length-2),{...t,nested:!0})}],It=x(Tt,{parseOnNested:!1,parseOnQuoted:!0,patterns:[vt]}),Lt=/\\[\\$ .+? \\]/,Mt=/\\[\\$ [^\\]]+\\]/,Ct=(e,t)=>t.context===\"table\"?h(e,t):[{type:\"formula\",raw:e,formula:e.substring(3,e.length-(e.endsWith(\" ]\")?2:1))}],Ot=x(Ct,{parseOnNested:!1,parseOnQuoted:!0,patterns:[Lt,Mt]}),Nt=/\\[[!\"#%&'()*+,\\-./{|}<>_~]+ (?:\\[[^[\\]]+\\]|[^\\]])+\\]/,St=(e,t)=>{if(t.context===\"table\")return h(e,t);let r=e.indexOf(\" \"),n=e.substring(1,r),o=e.substring(r+1,e.length-1),s=new Set(n);if(s.has(\"*\")){let a=n.split(\"*\").length-1;s.delete(\"*\"),s.add(`*-${Math.min(a,10)}`)}return[{type:\"decoration\",raw:e,rawDecos:n,decos:Array.from(s),nodes:H(o,{...t,nested:!0})}]},Pt=x(St,{parseOnNested:!1,parseOnQuoted:!0,patterns:[Nt]}),At=/`.*?`/,Ht=(e,t)=>t.context===\"table\"?h(e,t):[{type:\"code\",raw:e,text:e.substring(1,e.length-1)}],Rt=x(Ht,{parseOnNested:!1,parseOnQuoted:!0,patterns:[At]}),_t=/^[$%] .+$/,jt=(e,t)=>{var r;if(t.context===\"table\")return h(e,t);let n=(r=e[0])!==null&&r!==void 0?r:\"\",o=e.substring(2);return[{type:\"commandLine\",raw:e,symbol:n,text:o}]},$t=x(jt,{parseOnNested:!1,parseOnQuoted:!1,patterns:[_t]}),Ut=/\\[\\s+\\]/,Ft=(e,t)=>t.context===\"table\"?h(e,t):[{type:\"blank\",raw:e,text:e.substring(1,e.length-1)}],Wt=x(Ft,{parseOnNested:!1,parseOnQuoted:!0,patterns:[Ut]}),Yt=/\\[https?:\\/\\/[^\\s\\]]+\\.(?:png|jpe?g|gif|svg)(?:\\?[^\\]\\s]+)?(?:\\s+https?:\\/\\/[^\\s\\]]+)?\\]/i,qt=/\\[https?:\\/\\/[^\\s\\]]+\\s+https?:\\/\\/[^\\s\\]]+\\.(?:png|jpe?g|gif|svg)(?:\\?[^\\]\\s]+)?\\]/i,Bt=/\\[https?:\\/\\/(?:[0-9a-z-]+\\.)?gyazo\\.com\\/[0-9a-f]{32}(?:\\/raw)?(?:\\s+https?:\\/\\/[^\\s\\]]+)?\\]/,Kt=/\\[https?:\\/\\/[^\\s\\]]+\\s+https?:\\/\\/(?:[0-9a-z-]+\\.)?gyazo\\.com\\/[0-9a-f]{32}(?:\\/raw)?\\]/,zt=e=>/^https?:\\/\\/[^\\s\\]]+\\.(png|jpe?g|gif|svg)(\\?[^\\]\\s]+)?$/i.test(e)||Qt(e),Qt=e=>/^https?:\\/\\/([0-9a-z-]\\.)?gyazo\\.com\\/[0-9a-f]{32}(\\/raw)?$/.test(e),Xt=(e,t)=>{if(t.context===\"table\")return h(e,t);let r=e.search(/\\s/),n=r!==-1?e.substring(1,r):e.substring(1,e.length-1),o=r!==-1?e.substring(r,e.length-1).trimLeft():\"\",[s,a]=zt(o)?[o,n]:[n,o];return[{type:\"image\",raw:e,src:/^https?:\\/\\/([0-9a-z-]\\.)?gyazo\\.com\\/[0-9a-f]{32}$/.test(s)?`${s}/thumb/1000`:s,link:a}]},Gt=x(Xt,{parseOnNested:!0,parseOnQuoted:!0,patterns:[Yt,qt,Bt,Kt]}),Vt=/\\[https?:\\/\\/[^\\s\\]]+\\s+[^\\]]*[^\\s]\\]/,Jt=/\\[[^[\\]]*[^\\s]\\s+https?:\\/\\/[^\\s\\]]+\\]/,Zt=/\\[https?:\\/\\/[^\\s\\]]+\\]/,er=/https?:\\/\\/[^\\s]+/,tr=(e,t)=>{if(t.context===\"table\")return h(e,t);let r=e.startsWith(\"[\")&&e.endsWith(\"]\")?e.substring(1,e.length-1):e,n=/^https?:\\/\\/[^\\s\\]]/.test(r),o=(n?/^https?:\\/\\/[^\\s\\]]+/:/https?:\\/\\/[^\\s\\]]+$/).exec(r);if(o?.[0]===void 0)return[];let s=n?r.substring(o[0].length):r.substring(0,o.index-1);return[{type:\"link\",raw:e,pathType:\"absolute\",href:o[0],content:s.trim()}]},rr=x(tr,{parseOnNested:!0,parseOnQuoted:!0,patterns:[Vt,Jt,Zt,er]}),Le=/\\[([^\\]]*[^\\s])\\s+([NS]\\d+(?:\\.\\d+)?,[EW]\\d+(?:\\.\\d+)?(?:,Z\\d+)?)\\]/,Me=/\\[([NS]\\d+(?:\\.\\d+)?,[EW]\\d+(?:\\.\\d+)?(?:,Z\\d+)?)(?:\\s+([^\\]]*[^\\s]))?\\]/,nr=e=>{let[t=\"\",r=\"\",n=\"\"]=e.split(\",\"),o=parseFloat(t.replace(/^N/,\"\").replace(/^S/,\"-\")),s=parseFloat(r.replace(/^E/,\"\").replace(/^W/,\"-\")),a=/^Z\\d+$/.test(n)?parseInt(n.replace(/^Z/,\"\"),10):14;return{latitude:o,longitude:s,zoom:a}},or=(e,t)=>{var r;if(t.context===\"table\")return h(e,t);let n=(r=e.match(Le))!==null&&r!==void 0?r:e.match(Me);if(n===null)return[];let o=e.startsWith(\"[N\")||e.startsWith(\"[S\"),[,s=\"\",a=\"\"]=o?n:[n[0],n[2],n[1]],{latitude:i,longitude:c,zoom:d}=nr(s),u=a!==\"\"?`https://www.google.com/maps/place/${encodeURIComponent(a)}/@${i},${c},${d}z`:`https://www.google.com/maps/@${i},${c},${d}z`;return[{type:\"googleMap\",raw:e,latitude:i,longitude:c,zoom:d,place:a,url:u}]},sr=x(or,{parseOnNested:!1,parseOnQuoted:!0,patterns:[Le,Me]}),ir=/\\[\\/?[^[\\]]+\\]/,ar=e=>{let t=e.substring(1,e.length-1);return[{type:\"link\",raw:e,pathType:t.startsWith(\"/\")?\"root\":\"relative\",href:t,content:\"\"}]},cr=x(ar,{parseOnNested:!0,parseOnQuoted:!0,patterns:[ir]}),ur=/(?:^|\\s)#\\S+/,dr=(e,t)=>{if(t.context===\"table\")return h(e,t);if(e.startsWith(\"#\"))return[{type:\"hashTag\",raw:e,href:e.substring(1)}];let r=e.substring(0,1),n=e.substring(1);return[...h(r,t),{type:\"hashTag\",raw:n,href:n.substring(1)}]},pr=x(dr,{parseOnNested:!0,parseOnQuoted:!0,patterns:[ur]}),lr=(e,t,r)=>{var n;return e===\"\"?[]:(n=r?.())!==null&&n!==void 0?n:[]},mr=(...e)=>(t,r)=>e.reduceRight((n,o)=>()=>o(t,r,n),()=>at(t,r))(),H=mr(lr,dt,mt,Rt,$t,Ot,Wt,Pt,ht,Dt,It,Gt,rr,wt,sr,cr,pr),fr=e=>{let{rows:[t,...r]}=e,{indent:n=0,text:o=\"\"}=t??{},s=o.replace(/^\\s*table:/,\"\");return{indent:n,type:\"table\",fileName:s,cells:r.map(a=>a.text.substring(n+1)).map(a=>a.split(\"\t\").map(i=>H(i,{nested:!1,quoted:!1,context:\"table\"})))}},gr=e=>{let{indent:t,text:r}=e.rows[0];return{indent:t,type:\"line\",nodes:H(r.substring(t),{nested:!1,quoted:!1,context:\"line\"})}},Ce=e=>{switch(e.type){case\"title\":return st(e);case\"codeBlock\":return it(e);case\"table\":return fr(e);case\"line\":return gr(e)}},Oe=e=>e.split(`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279591,
      "updated": 1653279591
    },
    {
      "id": "628b0b66aff09e00007f7630",
      "text": " `).map(t=>{var r,n,o;return{indent:(o=(n=(r=/^\\s+/.exec(t))===null||r===void 0?void 0:r[0])===null||n===void 0?void 0:n.length)!==null&&o!==void 0?o:0,text:t}}),xr=(e,t)=>{var r,n;return(e.type===\"codeBlock\"||e.type===\"table\")&&t.indent>((n=(r=e.rows[0])===null||r===void 0?void 0:r.indent)!==null&&n!==void 0?n:0)},Ne=(e,t)=>{let r=e[e.length-1];return r!==void 0&&xr(r,t)?(r.rows.push(t),e):(e.push({type:/^\\s*code:/.test(t.text)?\"codeBlock\":/^\\s*table:/.test(t.text)?\"table\":\"line\",rows:[t]}),e)},Se=(e,t)=>{var r;if(!((r=t.hasTitle)!==null&&r!==void 0)||r){let[n,...o]=e;return n===void 0?[]:[{type:\"title\",rows:[n]},...o.reduce(Ne,[])]}return e.reduce(Ne,[])};function Pe(e,t,{userId:r,head:n}){let o=t.flatMap(u=>u.split(`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279591,
      "updated": 1653279591
    },
    {
      "id": "628b0b66aff09e00007f7631",
      "text": " `)),s=[...Te(e,o,{userId:r})];(e[0].text!==o[0]||!n.persistent)&&s.push({title:o[0]});let a=e.slice(1,6).map(u=>u.text),i=o.slice(1,6);a.join(\"\")!==i.join(\"\")&&s.push({descriptions:i});let[c,d]=hr(o.join(`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279591,
      "updated": 1653279591
    },
    {
      "id": "628b0b66aff09e00007f7632",
      "text": " `));return(n.links.length!==c.length||!n.links.every(u=>c.includes(u)))&&s.push({links:c}),n.image!==d&&s.push({image:d}),s}function hr(e){let t=Oe(e),r=Se(t,{hasTitle:!0}).flatMap(i=>{switch(i.type){case\"codeBlock\":case\"title\":return[];case\"line\":case\"table\":return[Ce(i)]}}),n=new Map,o=[],s=null,a=i=>{switch(i.type){case\"hashTag\":if(n.has(U(i.href)))return;n.set(U(i.href),!1),o.push(i.href);return;case\"link\":if(i.pathType!==\"relative\"||n.get(U(i.href)))return;n.set(U(i.href),!0),o.push(i.href);return;case\"image\":case\"strongImage\":{s??=i.src.endsWith(\"/thumb/1000\")?i.src.replace(/\\/thumb\\/1000$/,\"/raw\"):i.src;return}case\"strong\":case\"quote\":case\"decoration\":{for(let c of i.nodes)a(c);return}default:return}};for(let i of yr(r))a(i);return[o,s]}function*yr(e){for(let t of e)switch(t.type){case\"codeBlock\":case\"title\":continue;case\"line\":for(let r of t.nodes)yield r;continue;case\"table\":{for(let r of t.cells)for(let n of r)for(let o of n)yield o;continue}}}async function M(e,t){let r=await le(e,t);if(!r.ok)throw new Error(`You have no privilege of editing \"/${e}/${t}\".`);let{commitId:n,persistent:o,image:s,links:a,lines:i,id:c,pin:d}=r.value;return{commitId:n,pageId:c,persistent:o,image:s,links:a,pin:d,lines:i}}async function K(e,t,r){return t.length===0?{commitId:r.parentId}:await e(\"socket.io-request\",{method:\"commit\",data:{kind:\"page\",...r,changes:t,cursor:null,freeze:!0}})}async function R(e,t,{project:r,title:n,retry:o=3,parentId:s,...a}){try{s=(await K(e,t,{parentId:s,...a})).commitId}catch{console.log(\"Faild to push a commit. Retry after pulling new commits\");for(let c=0;c<o;c++){let{commitId:d}=await M(r,n);s=d;try{s=(await K(e,t,{parentId:s,...a})).commitId,console.log(\"Success in retrying\");break}catch{continue}}throw Error(\"Faild to retry pushing.\")}return s}async function ne(e,t,r,n){let[o,s,a]=await Promise.all([M(e,t),A(e),_()]),i=o,c=n?.socket,d=c??await D();await P(d);try{let{request:u}=N(d);for(let y=0;y<3;y++)try{let f=r(i.lines,i),k=f instanceof Promise?await f:f;if(!k)return;k.length===0&&await R(u,[{deleted:!0}],{projectId:s,pageId:i.pageId,parentId:i.commitId,userId:a,project:e,title:t});let b=Pe(i.lines,k,{userId:a,head:i});await K(u,b,{parentId:i.commitId,projectId:s,pageId:i.pageId,userId:a});break}catch{if(y===2)throw Error(\"Faild to retry pushing.\");console.log(\"Faild to push a commit. Retry after pulling new commits\");try{i=await M(e,t)}catch(k){throw k}}}finally{c||await v(d)}}async function oe(e,t,r){let[n,o,s]=await Promise.all([M(e,t),A(e),_()]);if(n.pin>0||!n.persistent&&!(r?.create??!1))return;let a={parentId:n.commitId,projectId:o,pageId:n.pageId,userId:s,project:e,title:t},i=r?.socket,c=i??await D();await P(c);let{request:d}=N(c);if(!n.persistent){let u=await R(d,[{title:t}],a);a.parentId=u}try{await R(d,[{pin:br()}],a)}finally{i||await v(c)}}async function se(e,t,r){let[n,o,s]=await Promise.all([M(e,t),A(e),_()]);if(n.pin==0||!n.persistent)return;let a={parentId:n.commitId,projectId:o,pageId:n.pageId,userId:s,project:e,title:t},i=r?.socket,c=i??await D();await P(c);let{request:d}=N(c);try{await R(d,[{pin:0}],a)}finally{i||await v(c)}}var br=()=>Number.MAX_SAFE_INTEGER-Math.floor(Date.now()/1e3);async function*ie(e,t=0){let{count:r,pages:n}=await wr(e,t);for(let o of n)o.pin!==0&&(yield o);(n.at(-1)?.pin??0)!==0&&(yield*ie(e,t+1e3))}async function wr(e,t){let r=await ee(e,{limit:1e3,skip:t});if(!r.ok){let n=new Error;throw n.name=r.value.name,n.message=r.value.message,n}return r.value}function Ae(e,t){let r=t.interval??24*3600*1e3,n=()=>scrapbox.Project.name===e?kr(e,r,t):Re();n(),scrapbox.addListener(\"project:changed\",n)}var He;async function kr(e,t,r){Re(),await _e(e,new Date,r),He=setInterval(()=>_e(e,new Date,r),t)}function Re(){clearInterval(He)}async function _e(e,t,{makeDiary:r,filter:n}){let{render:o,dispose:s}=te(),a;try{o({type:\"spinner\"},{type:\"text\",text:\"unpin other diary pages...\"}),a=await re();for await(let{title:u}of ie(e))n(u,t)||await se(e,u,{socket:a});let{title:i,header:c,footer:d}=r(t);o({type:\"spinner\"},{type:\"text\",text:`pin \"/${e}/${i}\"...`}),await oe(e,i,{socket:a,create:!0}),o({type:\"spinner\"},{type:\"text\",text:`format \"/${e}/${i}\"...`}),await ne(e,i,u=>[u[0].text,...V(u.slice(1).map(y=>y.text),c,d)],{socket:a}),o({type:\"check-circle\"},{type:\"text\",text:`Pinned \"/${e}/${i}\".`})}catch(i){o({type:\"exclamation-triangle\"},{type:\"text\",text:i instanceof Error?`${i.name} ${i.message}`:\"Unknown error! (see developper console)\"}),console.error(i)}finally{a&&await v(a),await F(1e3),s()}}function p(e,t){if(t.length<e)throw new TypeError(e+\" argument\"+(e>1?\"s\":\"\")+\" required, but only \"+t.length+\" present\")}function m(e){p(1,arguments);let t=Object.prototype.toString.call(e);return e instanceof Date||typeof e==\"object\"&&t===\"[object Date]\"?new Date(e.getTime()):typeof e==\"number\"||t===\"[object Number]\"?new Date(e):((typeof e==\"string\"||t===\"[object String]\")&&typeof console!=\"undefined\"&&(console.warn(\"Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule\"),console.warn(new Error().stack)),new Date(NaN))}function z(e){let t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function g(e){if(e===null||e===!0||e===!1)return NaN;let t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function j(e,t){p(2,arguments);let r=m(e),n=g(t);return isNaN(n)?new Date(NaN):(n&&r.setDate(r.getDate()+n),r)}function W(e,t){p(2,arguments);let r=g(t);return j(e,-r)}function ae(e,t){p(2,arguments);let r=m(e),n=g(t);if(isNaN(n))return new Date(NaN);if(!n)return r;let o=r.getDate(),s=new Date(r.getTime());s.setMonth(r.getMonth()+n+1,0);let a=s.getDate();return o>=a?s:(r.setFullYear(s.getFullYear(),s.getMonth(),o),r)}function ce(e,t){p(2,arguments);let r=g(t);return ae(e,r*12)}function Q(e,t){p(2,arguments);let r=g(t);return ce(e,-r)}function T(e,t){for(var r=e<0?\"-\":\"\",n=Math.abs(e).toString();n.length<t;)n=\"0\"+n;return r+n}var Er={y(e,t){let r=e.getUTCFullYear(),n=r>0?r:1-r;return T(t===\"yy\"?n%100:n,t.length)},M(e,t){let r=e.getUTCMonth();return t===\"M\"?String(r+1):T(r+1,2)},d(e,t){return T(e.getUTCDate(),t.length)},a(e,t){let r=e.getUTCHours()/12>=1?\"pm\":\"am\";switch(t){case\"a\":case\"aa\":return r.toUpperCase();case\"aaa\":return r;case\"aaaaa\":return r[0];case\"aaaa\":default:return r===\"am\"?\"a.m.\":\"p.m.\"}},h(e,t){return T(e.getUTCHours()%12||12,t.length)},H(e,t){return T(e.getUTCHours(),t.length)},m(e,t){return T(e.getUTCMinutes(),t.length)},s(e,t){return T(e.getUTCSeconds(),t.length)},S(e,t){let r=t.length,n=e.getUTCMilliseconds(),o=Math.floor(n*Math.pow(10,r-3));return T(o,t.length)}},$e=Er;function ue(e){p(1,arguments);var t=m(e);return!isNaN(t)}function de(e,t){p(2,arguments);let r=m(e).getTime(),n=g(t);return new Date(r+n)}function pe(e,t){p(2,arguments);let r=g(t);return de(e,-r)}var Dr=/(\\w)\\1*|''|'(''|[^'])+('|$)|./g,vr=/^'([^]*?)'?$/,Tr=/''/g,Ir=/[a-zA-Z]/;function C(e,t){p(2,arguments);let r=m(e);if(!ue(r))throw new RangeError(\"Invalid time value\");let n=z(r),o=pe(r,n),s=t.match(Dr);return s?s.map(i=>{if(i===\"''\")return\"'\";let c=i[0];if(c===\"'\")return Lr(i);let d=$e[c];if(d)return d(o,i);if(c.match(Ir))throw new RangeError(\"Format string contains an unescaped latin alphabet character `\"+c+\"`\");return i}).join(\"\"):\"\"}function Lr(e){let t=e.match(vr);return t?t[1].replace(Tr,\"'\"):e}var $=\"日記yyyy-MM-dd\",Cr=/^日記\\d{4}-\\d{2}-\\d{2}$/;function Ue(e){return{title:We(e),header:[],footer:[`[${C(W(e,1),$)}]←${C(e,$)}→[${C(j(e,1),$)}]`,`100日前 [${C(W(e,100),$)}]`,`1年前 [${C(Q(e,1),$)}]`]}}function Fe(e,t){return Cr.test(e)?We(t)===e:!0}function We(e){return C(e,$)}Ae(\"nishio\",{makeDiary:Ue,filter:Fe});",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653279591,
      "updated": 1653279591
    },
    {
      "id": "62888d91aff09e0000698c60",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1653116306,
      "updated": 1653116306
    }
  ]
}