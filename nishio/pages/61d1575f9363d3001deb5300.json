{
  "id": "61d1575f9363d3001deb5300",
  "title": "マイクラ内でいいね",
  "created": 1641109365,
  "updated": 1641109443,
  "lines": [
    {
      "id": "61d1575f9363d3001deb5300",
      "text": "マイクラ内でいいね",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e55c",
      "text": "できた",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e55d",
      "text": "[https://youtu.be/x85oTw5-ZGg]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e55e",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e55f",
      "text": "仕組み",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e560",
      "text": "　ボタンを押すとコマンドブロックが`webhooks execute post-like x`を実行(x部分は任意の名前)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e561",
      "text": "　[SimpleWebhooks] が `http://localhost:5000/`に名前をPOST",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e562",
      "text": "　localhostで動いてるFlaskがリクエストを受け取って[RCON]でコマンド実行",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e563",
      "text": "\t\t`command = f\"data get storage likes {name}\"`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e564",
      "text": "\t\t　[storage]からいいねの数を取得",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e565",
      "text": "\t\t　1増やす",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e566",
      "text": "\t\t`command = f\"data modify storage likes {name} set value {value}\"`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e567",
      "text": "\t\t　増やした値をstorageに書き込む",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e568",
      "text": "\t\t`command = f\"hd setLine likes_{name} 1 LIKE: {value}\"`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e569",
      "text": "　　　[Holographic Displays]を更新",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e56a",
      "text": "　　　HDの名前は`likes_x`という形になってる想定",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e56b",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e56c",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e56d",
      "text": "　code:SimpleWebhooks/config.yaml",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e56e",
      "text": "  post-like:",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e56f",
      "text": "    url: http://localhost:5000/",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e570",
      "text": "    json:",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e571",
      "text": "      name: \"{COMMAND_PARAM_1}\"",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e572",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e573",
      "text": "code:server.py",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e574",
      "text": " from flask import Flask, request",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e575",
      "text": " from aiomcrcon import Client",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e576",
      "text": " import asyncio",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e577",
      "text": " import re",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e578",
      "text": " import threading",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e579",
      "text": " from secret import PASSWORD, HOST, PORT",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e57a",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e57b",
      "text": " app = Flask(__name__)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e57c",
      "text": " client = Client(HOST, PORT, PASSWORD)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e57d",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e57e",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e57f",
      "text": " def create_app():",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e580",
      "text": "     return app",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e581",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e582",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e583",
      "text": " async def update_likes(name):",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e584",
      "text": "     await client.connect()",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e585",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e586",
      "text": "     command = f\"data get storage likes {name}\"",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e587",
      "text": "     response = await client.send_cmd(command)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e588",
      "text": "     if \"Found no elements matching\" in response[0]:",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e589",
      "text": "         value = 0",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e58a",
      "text": "     else:",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e58b",
      "text": "         value = int(re.search(\"\\d+\", response[0]).group())",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e58c",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e58d",
      "text": "     value += 1",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e58e",
      "text": "     command = f\"data modify storage likes {name} set value {value}\"",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e58f",
      "text": "     response = await client.send_cmd(command)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e590",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e591",
      "text": "     command = f\"hd setLine likes_{name} 1 LIKE: {value}\"",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e592",
      "text": "     response = await client.send_cmd(command)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e593",
      "text": "     ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e594",
      "text": "     await client.close()",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e595",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e596",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e597",
      "text": " @app.route('/', methods=['GET', 'POST'])",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e598",
      "text": " def root():",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e599",
      "text": "     if request.method == \"GET\":",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e59a",
      "text": "         return \"OK\"",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e59b",
      "text": "     else:",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e59c",
      "text": "         name = request.json[\"name\"]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e59d",
      "text": " ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e59e",
      "text": "     x = threading.Thread(target=lambda: asyncio.run(update_likes(name)), args=()).start()",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e59f",
      "text": "     return \"OK\"",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e5a0",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e5a1",
      "text": "ハマりどころ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e5a2",
      "text": "　Webhookに対してRCONを実行する前にOKを返す必要がある",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e5a3",
      "text": "　　RCONパケットを送っても実行されずタイムアウトする",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e5a4",
      "text": "　　おそらくWebhookコマンドがロックをつかんでいる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15775aff09e000070e5a5",
      "text": "　　そこでスレッドを作る形にした",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109365,
      "updated": 1641109365
    },
    {
      "id": "61d15795aff09e000070e5a6",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109397,
      "updated": 1641109397
    },
    {
      "id": "61d15795aff09e000070e5a7",
      "text": "元ネタ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109397,
      "updated": 1641109404
    },
    {
      "id": "61d157b2aff09e000070e5ac",
      "text": "\tVirtualPersentsのいいね機能",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109426,
      "updated": 1641109442
    },
    {
      "id": "61d1579caff09e000070e5a9",
      "text": "\t\t[https://gyazo.com/d9056b3fc37945d0d7b84cb579fccd2e]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109404,
      "updated": 1641109443
    },
    {
      "id": "61d1579daff09e000070e5aa",
      "text": "\t\thttps://jr.mitou.org/projects/2019/virtual_presents",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109405,
      "updated": 1641109410
    },
    {
      "id": "61d1579caff09e000070e5a8",
      "text": "\t[デスストランディング]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109404,
      "updated": 1641109418
    },
    {
      "id": "61d157a3aff09e000070e5ab",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1641109412,
      "updated": 1641109412
    }
  ]
}